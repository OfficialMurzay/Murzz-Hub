-- MurzzHub v1.0k Beta (UI + Player Data, Stats & Quest Overview + Info Tab + Auto Quest Detection & Completion)
-- Author: Murzay (Modified by ChatGPT)
-- VERSION NOTE: v1.0j -> v1.0k; next after z would be 1.01a etc.

-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer
local OtherData = Player:WaitForChild("OtherData")
local StatsFolder = Player:WaitForChild("Stats")
local QuestsFolder = Player:WaitForChild("Quests")

-------------------------------------------------
-- VERSION
-------------------------------------------------
local VERSION = "v1.0k Beta"

-------------------------------------------------
-- RAYFIELD
-------------------------------------------------
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "MurzzHub "..VERSION,
    LoadingTitle = "MurzzHub "..VERSION,
    LoadingSubtitle = VERSION.." - UI Live Player Data, Stats & Quests",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MurzzHub",
        FileName = "AFSE_UI"
    },
    KeySystem = false
})

-------------------------------------------------
-- INFO TAB
-------------------------------------------------
local InfoTab = Window:CreateTab("Info ðŸ› ï¸")

-- Update Log Section
InfoTab:CreateSection("Update Log ðŸ“")
InfoTab:CreateParagraph({
    Title = "Update Log v1.0k: Auto Quest + Completion âœ…",
    Content = "Added auto-detect for new quests and completion highlights!"
})

-- Discord Section
InfoTab:CreateSection("Discord ðŸ’¬")

-- Username as gold-colored label
local usernameLabel = InfoTab:CreateLabel("Dear @"..Player.DisplayName..",")
if usernameLabel.SetColor then
    usernameLabel:SetColor(Color3.fromRGB(255, 215, 0)) -- Gold
end

-- Paragraph with message
InfoTab:CreateParagraph({
    Title = "Message",
    Content = [[
Thank you for using my script! Every use really supports me, and gives me motivation to continue updating this script!
If you have any suggestions, or just want to see the sneak peaks, events and more then join the Discord Server! â¤ï¸ - Murzay (Scripter)
]]
})

-- Discord button with purple gradient
InfoTab:CreateButton({
    Name = {
        Text = "Join The Discord Server!",
        Color = {Color3.fromRGB(128, 0, 128), Color3.fromRGB(255, 0, 255)} -- purple gradient
    },
    Callback = function()
        local discordLink = "DISCORD_LINK_HERE"
        if discordLink and discordLink ~= "" then
            if syn and syn.request then
                syn.request({Url = discordLink})
            else
                setclipboard(discordLink)
            end
        end
    end
})

-------------------------------------------------
-- CLASS MAP
-------------------------------------------------
local ClassMap = {
    [1]="Fighter ðŸ¥Š",[2]="Shinobi ðŸŒ€",[3]="Pirate â˜ ï¸",[4]="Ghoul ðŸ‘»",[5]="Hero ðŸ¦¸",
    [6]="Reaper â˜ ï¸",[7]="Saiyan ðŸ’¥",[8]="Sin ðŸ˜ˆ",[9]="Magi ðŸ§™",[10]="Akuma ðŸ˜¡",
    [11]="Yonko ðŸ´â€â˜ ï¸",[12]="Gorosei ðŸ§“",[13]="Overlord ðŸ‘‘",[14]="Hokage ðŸ¦Š",
    [15]="Kaioshin ðŸ‘¼",[16]="Sage ðŸ•Šï¸",[17]="Espada âš”ï¸",[18]="Shinigami ðŸ‘¹",
    [19]="Hashira âš”ï¸",[20]="Hakaishin ðŸ’€",[21]="Otsutsuki ðŸŒŒ",
    [22]="Pirate King ðŸ´â€â˜ ï¸ðŸ‘‘",[23]="Kishin ðŸ‘¿",[24]="Angel ðŸ˜‡",
    [25]="Demon King ðŸ‘¹",[26]="Ultra Instinct âœ¨",[27]="Upper Moon ðŸŒ™"
}

-------------------------------------------------
-- STAT MAP
-------------------------------------------------
local StatIdToName = {
    [1]="Strength ðŸ’ª",
    [2]="Durability ðŸ›¡ï¸",
    [3]="Chakra ðŸŒ€",
    [4]="Sword ðŸ—¡ï¸",
    [5]="Speed ðŸ’¨",
    [6]="Agility â˜ï¸"
}

-------------------------------------------------
-- UTILITIES
-------------------------------------------------
local function abbreviateNumber(num)
    if not num then return "0" end
    local absNum = math.abs(num)
    if absNum >= 1e21 then return string.format("%.2fSx", num/1e21)
    elseif absNum >= 1e18 then return string.format("%.2fQn", num/1e18)
    elseif absNum >= 1e15 then return string.format("%.2fQd", num/1e15)
    elseif absNum >= 1e12 then return string.format("%.2fT", num/1e12)
    elseif absNum >= 1e9 then return string.format("%.2fB", num/1e9)
    elseif absNum >= 1e6 then return string.format("%.2fM", num/1e6)
    elseif absNum >= 1e3 then return string.format("%.2fK", num/1e3)
    else return tostring(num) end
end

local function animateValue(label, startVal, endVal, prefix, emoji, duration)
    if startVal == endVal then return end
    local step = (endVal - startVal) / (duration * 30)
    local current = startVal
    local connection
    connection = RunService.RenderStepped:Connect(function()
        current = current + step
        if (step > 0 and current >= endVal) or (step < 0 and current <= endVal) then
            current = endVal
            connection:Disconnect()
        end
        if label and label.Set then
            label:Set(prefix..abbreviateNumber(math.floor(current)).." "..emoji)
        end
    end)
end

-------------------------------------------------
-- HOME TAB
-------------------------------------------------
local HomeTab = Window:CreateTab("Home ðŸ ")

-- Player Data
HomeTab:CreateSection("Player Data ðŸ‘¤")
local ClassLabel = HomeTab:CreateLabel("Class: ...")
local PowerLabel = HomeTab:CreateLabel("Total Power: ... âš¡")
local YenLabel = HomeTab:CreateLabel("Money: ... ðŸ’°")
local ChikaraLabel = HomeTab:CreateLabel("Chikara: ... ðŸ’Ž")

-- Live Stats
HomeTab:CreateSection("Live Stats ðŸ“Š")
local LiveStats = {}
for statId, name in pairs(StatIdToName) do
    local statName, emoji = name:match("^(.-) (.+)$")
    LiveStats[statId] = {
        Label = HomeTab:CreateLabel(statName..": ... "..emoji),
        Value = 0,
        Emoji = emoji,
        StatName = statName
    }
end

-- Quest Overview
HomeTab:CreateSection("Quest Overview ðŸ“œ")
local QuestOverviewLabels = {}

local function createQuestLabel(questFolder)
    local displayName = questFolder.Name
    local name, number = displayName:match("(%a+)(%d+)")
    if name and number then
        displayName = name.." No."..number
    end
    local label = HomeTab:CreateLabel(displayName.." [0%]")
    QuestOverviewLabels[questFolder.Name] = {Label = label, Completed = false}
end

-- Initial quests
for _, questFolder in ipairs(QuestsFolder:GetChildren()) do
    if questFolder:IsA("Folder") then
        createQuestLabel(questFolder)
    end
end

-- Detect new quests dynamically
QuestsFolder.ChildAdded:Connect(function(child)
    if child:IsA("Folder") and not QuestOverviewLabels[child.Name] then
        createQuestLabel(child)
    end
end)

-------------------------------------------------
-- PLAYER DATA & STATS LIVE UPDATE
-------------------------------------------------
local currentPower, currentYen, currentChikara = 0, 0, 0

RunService.Heartbeat:Connect(function()
    -- Class
    if OtherData:FindFirstChild("Class") then
        ClassLabel:Set("Class: "..(ClassMap[OtherData.Class.Value] or "Unknown â“"))
    end

    -- Total Power
    if OtherData:FindFirstChild("TotalPower") then
        local target = OtherData.TotalPower.Value
        animateValue(PowerLabel, currentPower, target, "Total Power: ", "âš¡", 0.5)
        currentPower = target
    end

    -- Yen
    if OtherData:FindFirstChild("Yen") then
        local target = OtherData.Yen.Value
        animateValue(YenLabel, currentYen, target, "Money: ", "ðŸ’°", 0.5)
        currentYen = target
    end

    -- Chikara
    if OtherData:FindFirstChild("Chikara") then
        local target = OtherData.Chikara.Value
        animateValue(ChikaraLabel, currentChikara, target, "Chikara: ", "ðŸ’Ž", 0.5)
        currentChikara = target
    end

    -- Live Stats
    for statId, data in pairs(LiveStats) do
        local statObj = StatsFolder:FindFirstChild(tostring(statId))
        if statObj and statObj.Value ~= data.Value then
            animateValue(data.Label, data.Value, statObj.Value, data.StatName..": ", data.Emoji, 0.5)
            data.Value = statObj.Value
        end
    end

    -- Quest Percentages
    for questName, data in pairs(QuestOverviewLabels) do
        local questFolder = QuestsFolder:FindFirstChild(questName)
        if questFolder then
            local requirementsFolder = questFolder:FindFirstChild("Requirements")
            local progressFolder = questFolder:FindFirstChild("Progress")
            if requirementsFolder and progressFolder then
                local totalReq, totalProg = 0, 0
                for _, req in ipairs(requirementsFolder:GetChildren()) do
                    if req:IsA("IntValue") or req:IsA("NumberValue") then
                        totalReq = totalReq + req.Value
                    end
                end
                for _, prog in ipairs(progressFolder:GetChildren()) do
                    if prog:IsA("IntValue") or prog:IsA("NumberValue") then
                        totalProg = totalProg + prog.Value
                    end
                end

                local percent = 0
                if totalReq > 0 then
                    percent = math.floor((totalProg / totalReq) * 100)
                end

                local displayName = questFolder.Name
                local name, number = displayName:match("(%a+)(%d+)")
                if name and number then
                    displayName = name.." No."..number
                end

                local labelText = string.format("%s [%d%%]", displayName, percent)
                local labelObj = data.Label

                -- Completion highlight
                if percent >= 100 and not data.Completed then
                    data.Completed = true
                    labelObj:Set(labelText.." âœ…")
                    if labelObj.SetColor then
                        labelObj:SetColor(Color3.fromRGB(144, 238, 144)) -- light green
                    end
                    -- Notification
                    Rayfield:Notify({
                        Title = "âœ… You completed a quest!",
                        Content = "You completed "..displayName.."! Stay on that grinding streak!",
                        Duration = 5,
                        Image = 1580567251 -- Rayfield built-in tick icon
                    })
                else
                    labelObj:Set(labelText)
                end
            end
        end
    end
end)

-------------------------------------------------
-- DONE
-------------------------------------------------
Rayfield:LoadConfiguration()
print("[MurzzHub] UI + Player Data, Live Stats & Quest Overview "..VERSION.." loaded successfully")
