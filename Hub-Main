-- MurzzHub v1.0a Beta
-- Rayfield UI for Anime Fighting Simulator: Endless
-- Author: Murzay

--[[ 
ðŸ“ Features:
- Animated loading (stats count up from 0)
- Live player stats
- Live quests overview with percentage
- Abbreviated numbers (K, M, B, T, Qd, Qn, Sx)
- Class detection with emoji
- Modern, lively UI
- Automatic updates
- Safe section handling to prevent CreateLabel errors
]]

--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

--// Rayfield Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

--// Class Table with Emojis
local Classes = {
    [1]="Fighter ðŸ¥Š",[2]="Shinobi ðŸŒ€",[3]="Pirate â˜ ï¸",[4]="Ghoul ðŸ‘»",[5]="Hero ðŸ¦¸",
    [6]="Reaper â˜ ï¸",[7]="Saiyan ðŸ’¥",[8]="Sin ðŸ˜ˆ",[9]="Magi ðŸ§™",[10]="Akuma ðŸ˜¡",
    [11]="Yonko ðŸ´â€â˜ ï¸",[12]="Gorosei ðŸ§“",[13]="Overlord ðŸ‘‘",[14]="Hokage ðŸ¦Š",
    [15]="Kaioshin ðŸ‘¼",[16]="Sage ðŸ•Šï¸",[17]="Espada âš”ï¸",[18]="Shinigami ðŸ‘¹",
    [19]="Hashira âš”ï¸",[20]="Hakaishin ðŸ’€",[21]="Otsutsuki ðŸŒŒ",
    [22]="Pirate King ðŸ´â€â˜ ï¸ðŸ‘‘",[23]="Kishin ðŸ‘¿",[24]="Angel ðŸ˜‡",
    [25]="Demon King ðŸ‘¹",[26]="Ultra Instinct âœ¨",[27]="Upper Moon ðŸŒ™"
}

--// Utility: Format numbers
local function abbreviateNumber(num)
    local absNum = math.abs(num)
    if absNum >= 1e21 then return string.format("%.2fSx", num / 1e21)
    elseif absNum >= 1e18 then return string.format("%.2fQn", num / 1e18)
    elseif absNum >= 1e15 then return string.format("%.2fQd", num / 1e15)
    elseif absNum >= 1e12 then return string.format("%.2fT", num / 1e12)
    elseif absNum >= 1e9 then return string.format("%.2fB", num / 1e9)
    elseif absNum >= 1e6 then return string.format("%.2fM", num / 1e6)
    elseif absNum >= 1e3 then return string.format("%.2fK", num / 1e3)
    else return tostring(num)
    end
end

--// Animated increment function
local function animateValue(label, startVal, endVal, duration)
    local step = (endVal - startVal) / (duration * 30)
    local current = startVal
    local connection
    connection = RunService.RenderStepped:Connect(function()
        current = current + step
        if (step > 0 and current >= endVal) or (step < 0 and current <= endVal) then
            current = endVal
            connection:Disconnect()
        end
        if label and label.Set then
            label:Set(abbreviateNumber(math.floor(current)))
        end
    end)
end

--// Loading Screen
Rayfield:LoadConfiguration({
    Name = "MurzzHub Scripts",
    LoadingTitle = "MurzzHub Scripts",
    LoadingSubtitle = "v1.0a Beta",
    ConfigurationSaving = { Enabled = true, FolderName = nil, FileName = "MurzzHub" }
})

--// Main Window
local Window = Rayfield:CreateWindow({
    Name = "Murzzhub | AFSE",
    LoadingTitle = "MurzzHub Scripts",
    LoadingSubtitle = "v1.0a Beta",
    ConfigurationSaving = { Enabled = true, FolderName = nil, FileName = "MurzzHub" }
})

--// Home Tab
local HomeTab = Window:CreateTab("Home ðŸ ", nil)

-- Safe section creation
local function createSectionSafe(tab, title)
    local success, section = pcall(function()
        return tab:CreateSection(title)
    end)
    if success and section then return section end
    warn("Failed to create section:", title)
    return nil
end

-- Sections
local PlayerSection = createSectionSafe(HomeTab, "Player Data ðŸ§‘â€ðŸ’»")
local StatsSection = createSectionSafe(HomeTab, "Live Stats âš¡")
local QuestSection = createSectionSafe(HomeTab, "Quests Overview ðŸ—‚ï¸")

-- Player Data Labels
local ClassLabel, TotalPowerLabel, YenLabel, ChikaraLabel
if PlayerSection then
    ClassLabel = PlayerSection:CreateLabel({ Name = "Class: ..." })
    TotalPowerLabel = PlayerSection:CreateLabel({ Name = "Total Power: ..." })
    YenLabel = PlayerSection:CreateLabel({ Name = "Yen: ..." })
    ChikaraLabel = PlayerSection:CreateLabel({ Name = "Chikara: ..." })
end

-- Stats Labels
local StatLabels = {}
local StatNames = {"Strength", "Durability", "Chakra", "Sword", "Speed", "Agility"}
if StatsSection then
    for _, stat in ipairs(StatNames) do
        StatLabels[stat] = StatsSection:CreateLabel({ Name = stat.." : ..." })
    end
end

-- Quests Labels
local QuestLabels = {}

--// Update UI
local function updateUI()
    local OtherData = LocalPlayer:WaitForChild("OtherData")
    local Stats = LocalPlayer:WaitForChild("Stats")
    local Quests = LocalPlayer:WaitForChild("Quests")

    -- Player Data
    if ClassLabel then
        local classId = OtherData:WaitForChild("Class").Value
        ClassLabel:Set("Class: "..(Classes[classId] or "Unknown â“"))
    end
    if TotalPowerLabel then
        animateValue(TotalPowerLabel, tonumber(TotalPowerLabel.Name:match("%d+")) or 0, OtherData.TotalPower.Value, 0.5)
    end
    if YenLabel then
        animateValue(YenLabel, tonumber(YenLabel.Name:match("%d+")) or 0, OtherData.Yen.Value, 0.5)
    end
    if ChikaraLabel then
        animateValue(ChikaraLabel, tonumber(ChikaraLabel.Name:match("%d+")) or 0, OtherData.Chikara.Value, 0.5)
    end

    -- Stats
    for i, statName in ipairs(StatNames) do
        if StatLabels[statName] then
            local statValue = Stats[tostring(i)].Value
            animateValue(StatLabels[statName], tonumber(StatLabels[statName].Name:match("%d+")) or 0, statValue, 0.5)
        end
    end

    -- Quests
    for _, questFolder in ipairs(Quests:GetChildren()) do
        if QuestSection and not QuestLabels[questFolder.Name] then
            QuestLabels[questFolder.Name] = QuestSection:CreateLabel({ Name = questFolder.Name.." : 0%" })
        end

        local progressSum, requirementSum = 0, 0
        local Progress = questFolder:FindFirstChild("Progress")
        local Requirements = questFolder:FindFirstChild("Requirements")
        if Progress and Requirements then
            for i=1,6 do
                local progVal = Progress:FindFirstChild(tostring(i))
                local reqVal = Requirements:FindFirstChild(tostring(i))
                if progVal and reqVal then
                    progressSum = progressSum + progVal.Value
                    requirementSum = requirementSum + reqVal.Value
                end
            end
        end
        local percent = 0
        if requirementSum > 0 then
            percent = math.floor(progressSum / requirementSum * 100)
        end
        if QuestLabels[questFolder.Name] then
            QuestLabels[questFolder.Name]:Set(questFolder.Name.." : "..percent.."%")
        end
    end
end

-- Initial animated load
local function initialLoad()
    local OtherData = LocalPlayer:WaitForChild("OtherData")
    local Stats = LocalPlayer:WaitForChild("Stats")
    if TotalPowerLabel then animateValue(TotalPowerLabel, 0, OtherData.TotalPower.Value, 1) end
    if YenLabel then animateValue(YenLabel, 0, OtherData.Yen.Value, 1) end
    if ChikaraLabel then animateValue(ChikaraLabel, 0, OtherData.Chikara.Value, 1) end
    for i, statName in ipairs(StatNames) do
        if StatLabels[statName] then
            animateValue(StatLabels[statName], 0, Stats[tostring(i)].Value, 1)
        end
    end
end
initialLoad()

-- Update every frame
RunService.RenderStepped:Connect(updateUI)

-- Save/load Rayfield configuration
Rayfield:LoadConfiguration()
