-- MurzzHub v1.1 Release (Optimized for performance)
-- Full Stable Build (Home + Live Stats + Quests + Auto Train + Auto Chikara + Auto Quest)
-- Author: Murzay

-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local OtherData = Player:WaitForChild("OtherData")
local StatsFolder = Player:WaitForChild("Stats")
local QuestsFolder = Player:WaitForChild("Quests")

-------------------------------------------------
-- VERSION
-------------------------------------------------
local VERSION = "v1.1 Release"

-------------------------------------------------
-- SAFE DEBUG
-------------------------------------------------
local warned = false
local function safeRun(fn)
    if warned then return end
    local ok, err = pcall(fn)
    if not ok then
        warned = true
        warn("[MurzzHub Debug]", err)
    end
end

local function log(msg)
    print("[MurzzHub DEBUG]", msg)
end

-------------------------------------------------
-- RAYFIELD
-------------------------------------------------
local Rayfield
local retries = 0
repeat
    local success, result = pcall(function()
        return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
    end)
    if success then
        Rayfield = result
    else
        retries += 1
        warn("[MurzzHub] Rayfield load failed, retrying... ("..retries..")")
        task.wait(0.5)
    end
until Rayfield or retries >= 10

if not Rayfield then
    error("[MurzzHub] Failed to load Rayfield after 10 attempts.")
end

local Window = Rayfield:CreateWindow({
    Name = "MurzzHub | "..VERSION,
    LoadingTitle = "MurzzHub "..VERSION,
    LoadingSubtitle = "Auto Train, Chikara and more!",
    ConfigurationSaving = {Enabled=true, FolderName="MurzzHub", FileName="AFSE_UI"}
})
-------------------------------------------------
-- INFO TAB
-------------------------------------------------
local InfoTab = Window:CreateTab("Info ğŸ› ï¸")

InfoTab:CreateSection("Update Log ğŸ“")
InfoTab:CreateParagraph({Title = VERSION, Content = [[
â€¢ Updated Auto Farm section,
â€¢ Added Misc tab,
â€¢ Added Auto Fruit,
â€¢ Imrpoved Performance,
â€¢ Stay tuned for Auto Quests!
]]})

InfoTab:CreateSection("Discord ğŸ’¬")
InfoTab:CreateParagraph({Title = "Dear "..Player.DisplayName..",", Content = [[
Thank you for using Murzzhub!
I appreciate every second of you using my script!
If you have any suggestions, or want to see sneak peeks,
Join the discord! (None for now srry!)
]]})

InfoTab:CreateButton({Name = "Join The Discord!", Callback = function() setclipboard("No Discord For Now Sorry :(") end})

-------------------------------------------------
-- HOME TAB
-------------------------------------------------
local HomeTab = Window:CreateTab("Home ğŸ ")
HomeTab:CreateSection("Player Data ğŸ‘¤")

local ClassLabel = HomeTab:CreateLabel("Class: ...")
local PowerLabel = HomeTab:CreateLabel("Total Power: ... âš¡")
local YenLabel = HomeTab:CreateLabel("Money: ... ğŸ’°")
local ChikaraLabel = HomeTab:CreateLabel("Chikara: ... ğŸ’")

-- Optimized bindValue function
local function bindValue(obj, label, prefix, emoji)
    if not obj or not label then return end
    local current = obj.Value
    local function update()
        local newVal = obj.Value
        if newVal ~= current then
            animateNumber(label, current, newVal, prefix, emoji, 0.7)
            current = newVal
        end
    end
    update()
    obj:GetPropertyChangedSignal("Value"):Connect(update)
end

bindValue(OtherData:FindFirstChild("TotalPower"), PowerLabel, "Total Power: ", "âš¡")
bindValue(OtherData:FindFirstChild("Yen"), YenLabel, "Money: ", "ğŸ’°")
bindValue(OtherData:FindFirstChild("Chikara"), ChikaraLabel, "Chikara: ", "ğŸ’")

if OtherData:FindFirstChild("Class") then
    local currentClass = OtherData.Class.Value
    local function update()
        local newClass = OtherData.Class.Value
        if newClass ~= currentClass then
            ClassLabel:Set("Class: "..(ClassMap[newClass] or "Unknown â“"))
            currentClass = newClass
        end
    end
    update()
    OtherData.Class:GetPropertyChangedSignal("Value"):Connect(update)
end

-------------------------------------------------
-- LIVE STATS
-------------------------------------------------
HomeTab:CreateSection("Live Stats ğŸ“Š")

local OrderedStats = {
    {id="1", name="Strength", emoji="ğŸ’ª"},
    {id="2", name="Durability", emoji="ğŸ›¡ï¸"},
    {id="3", name="Chakra", emoji="ğŸŒ€"},
    {id="4", name="Sword", emoji="âš”ï¸"},
    {id="6", name="Speed", emoji="ğŸ’¨"},
    {id="5", name="Agility", emoji="â˜ï¸"},
}

for _, data in ipairs(OrderedStats) do
    local stat = StatsFolder:FindFirstChild(data.id)
    if stat then
        local current = stat.Value
        local label = HomeTab:CreateLabel(data.name..": ... "..data.emoji)
        local function update()
            local newVal = stat.Value
            if newVal ~= current then
                animateNumber(label, current, newVal, data.name..": ", data.emoji, 0.7)
                current = newVal
            end
        end
        update()
        stat:GetPropertyChangedSignal("Value"):Connect(update)
    end
end
