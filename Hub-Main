-- Services
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- Load Rayfield
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- ========================
-- Main Window
-- ========================
local Window = Rayfield:CreateWindow({
    Name = "MurzzHub v1.0",
    LoadingTitle = "MurzzHub v1.0",
    LoadingSubtitle = "Auto Train â€¢ Teleports",
    ConfigurationSaving = { Enabled = false },
    KeySystem = false
})

-- ========================
-- Home Tab
-- ========================
local HomeTab = Window:CreateTab("Home ðŸ ")

-- Player Data Section
HomeTab:CreateSection("Player Data ðŸ‘¤")
local OtherData = player:WaitForChild("OtherData")

local ClassLabel = HomeTab:CreateLabel("Class: ... ðŸ†")
local TotalPowerLabel = HomeTab:CreateLabel("Total Power: ... âš¡ï¸")
local YenLabel = HomeTab:CreateLabel("Yen: ... ðŸ’°")
local ChikaraLabel = HomeTab:CreateLabel("Chakira: ... ðŸ’Ž") -- UI text stays Chakira

-- Live Stats Section
HomeTab:CreateSection("Live Stats ðŸ“Š")

local StatEmojis = {
    Strength = "ðŸ’ª",
    Durability = "ðŸ›¡ï¸",
    Chakra = "ðŸŒ€",
    Sword = "ðŸ—¡ï¸",
    Agility = "â˜ï¸",
    Speed = "ðŸ’¨"
}

-- Ordered stats
local OrderedStats = {"Strength", "Durability", "Chakra", "Sword", "Speed", "Agility"}

-- Create labels for stats in fixed order
local liveStats = {}
for _, statName in ipairs(OrderedStats) do
    liveStats[statName] = HomeTab:CreateLabel(statName..": ... "..StatEmojis[statName])
end

local StatMap = {
    Strength = "1",
    Durability = "2",
    Chakra = "3",
    Sword = "4",
    Agility = "5",
    Speed = "6"
}

-- Classes mapping
local ClassMap = {
    [1] = "Fighter ðŸ¥Š",
    [2] = "Shinobi ðŸ¥·",
    [3] = "Pirate â˜ ï¸",
    [4] = "Ghoul ðŸ‘¹",
    [5] = "Hero ðŸ¦¸",
    [6] = "Reaper âš°ï¸",
    [7] = "Saiyan ðŸ’¥",
    [8] = "Sin ðŸ˜ˆ",
    [9] = "Magi ðŸ§™",
    [10] = "Akuma ðŸ‘¿",
    [11] = "Yonko ðŸ‘‘",
    [12] = "Gorosei ðŸ‘´",
    [13] = "Overlord ðŸ°",
    [14] = "Hokage ðŸ”¥",
    [15] = "Kaioshin âœ¨",
    [16] = "Sage ðŸƒ",
    [17] = "Espada âš”ï¸",
    [18] = "Shinigami âš°ï¸",
    [19] = "Hashira ðŸ—¡ï¸",
    [20] = "Hakaishin ðŸ’£",
    [21] = "Otsutsuki ðŸŒ™",
    [22] = "Pirate King ðŸ´â€â˜ ï¸",
    [23] = "Kishin ðŸ‘º",
    [24] = "Angel ðŸ˜‡",
    [25] = "Demon King ðŸ‘¹",
    [26] = "Ultra Instinct ðŸŒ€âœ¨",
    [27] = "Upper Moon ðŸŒ™ðŸ”"
}

-- Number Formatter
local function formatNumber(num)
    if not num then return "0" end
    num = tonumber(num)
    if not num then return "0" end
    local formats = {
        {1e18, "Qn"},
        {1e15, "Qd"},
        {1e12, "T"},
        {1e9,  "B"},
        {1e6,  "M"},
        {1e3,  "K"},
    }
    for _, f in ipairs(formats) do
        if num >= f[1] then
            return string.format("%.2f%s", num / f[1], f[2]):gsub("%.00", "")
        end
    end
    return tostring(num)
end

-- Animate numbers safely
local function animateValue(labelObj, statName, oldVal, newVal, emoji)
    local steps = 15
    local increment = (newVal - oldVal) / steps
    local current = oldVal
    for i = 1, steps do
        current = current + increment
        labelObj:Set(statName..": "..formatNumber(current).." "..emoji)
        RunService.RenderStepped:Wait()
    end
    labelObj:Set(statName..": "..formatNumber(newVal).." "..emoji)
end

-- Previous values
local previousStats = {}
local previousTotalPower = 0
local previousYen = 0
local previousChikara = 0

-- Home Tab Update Loop
task.spawn(function()
    while true do
        -- Stats
        local statsFolder = player:FindFirstChild("Stats")
        if statsFolder then
            for _, statName in ipairs(OrderedStats) do
                local stat = statsFolder:FindFirstChild(StatMap[statName])
                local value = stat and stat.Value or 0
                local oldValue = previousStats[statName] or 0
                if value ~= oldValue then
                    animateValue(liveStats[statName], statName, oldValue, value, StatEmojis[statName])
                    previousStats[statName] = value
                end
            end
        end

        -- Total Power
        local totalPower = (OtherData:FindFirstChild("TotalPower") and OtherData.TotalPower.Value) or 0
        if totalPower ~= previousTotalPower then
            animateValue(TotalPowerLabel, "Total Power", previousTotalPower, totalPower, "âš¡ï¸")
            previousTotalPower = totalPower
        end

        -- Class
        local classID = (OtherData:FindFirstChild("Class") and OtherData.Class.Value) or 0
        ClassLabel:Set("Class: "..(ClassMap[classID] or "Unknown â“"))

        -- Yen
        local yen = (OtherData:FindFirstChild("Yen") and OtherData.Yen.Value) or 0
        if yen ~= previousYen then
            animateValue(YenLabel, "Yen", previousYen, yen, "ðŸ’°")
            previousYen = yen
        end

        -- Chikara
        local chikara = (OtherData:FindFirstChild("Chikara") and OtherData.Chikara.Value) or 0
        if chikara ~= previousChikara then
            animateValue(ChikaraLabel, "Chakira", previousChikara, chikara, "ðŸ’Ž")
            previousChikara = chikara
        end

        task.wait(0.5)
    end
end)

-- ========================
-- Quests Tab
-- ========================
local QuestsTab = Window:CreateTab("Quests ðŸ¹")
local QuestsFolder = player:WaitForChild("Quests"):WaitForChild("Boom")

-- Function to create a single Boom quest UI
local function createBoomQuestUI(questFolder)
    if not questFolder then return end
    QuestsTab:CreateSection(questFolder.Name)
    
    local progressFolder = questFolder:FindFirstChild("Progress")
    local requirementsFolder = questFolder:FindFirstChild("Requirements")
    local rewardsFolder = questFolder:FindFirstChild("Rewards")
    
    -- Progress
    if progressFolder and requirementsFolder then
        for _, statValue in ipairs(progressFolder:GetChildren()) do
            local statID = tonumber(statValue.Name)
            local requirementValue = requirementsFolder:FindFirstChild(statValue.Name)
            local requirement = requirementValue and requirementValue.Value or 0
            QuestsTab:CreateLabel(formatNumber(statValue.Value).."/"..formatNumber(requirement).." "..(StatEmojis[statID] or ""))
        end
    end
    
    -- Rewards
    if rewardsFolder then
        local rewardParts = {}
        for _, reward in ipairs(rewardsFolder:GetChildren()) do
            if reward:IsA("IntValue") then
                local emoji = reward.Name == "Yen" and "ðŸ’°" or (reward.Name == "Chikara" and "ðŸ’Ž" or (reward.Name == "Power" and "âš¡ï¸" or ""))
                table.insert(rewardParts, formatNumber(reward.Value).." "..emoji)
            end
        end
        if #rewardParts > 0 then
            QuestsTab:CreateLabel("Rewards: "..table.concat(rewardParts, ", "))
        end
    end
end

-- Find all children in Boom folder that contain "Boom" in the name
for _, child in ipairs(QuestsFolder:GetChildren()) do
    if child:IsA("Folder") and child.Name:match("Boom") then
        createBoomQuestUI(child)
    end
end

-- ========================
-- Load Configuration
-- ========================
Rayfield:LoadConfiguration()
