-- MurzzHub v1.0u Beta
-- FULL RESTORED STABLE BUILD
-- Author: Murzay

-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local OtherData = Player:WaitForChild("OtherData")
local StatsFolder = Player:WaitForChild("Stats")
local QuestsFolder = Player:WaitForChild("Quests")

-------------------------------------------------
-- VERSION
-------------------------------------------------
local VERSION = "v1.0u Beta"

-------------------------------------------------
-- SAFE DEBUG
-------------------------------------------------
local warned = false
local function safeRun(fn)
    local ok, err = pcall(fn)
    if not ok and not warned then
        warned = true
        warn("[MurzzHub Debug] "..err)
    end
end

-------------------------------------------------
-- RAYFIELD
-------------------------------------------------
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "MurzzHub "..VERSION,
    LoadingTitle = "MurzzHub "..VERSION,
    LoadingSubtitle = "Full Stable Build",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MurzzHub",
        FileName = "AFSE_UI"
    }
})

-------------------------------------------------
-- UTIL
-------------------------------------------------
local function abbreviate(n)
    if n >= 1e18 then return string.format("%.2fQn", n/1e18)
    elseif n >= 1e15 then return string.format("%.2fQd", n/1e15)
    elseif n >= 1e12 then return string.format("%.2fT", n/1e12)
    elseif n >= 1e9 then return string.format("%.2fB", n/1e9)
    elseif n >= 1e6 then return string.format("%.2fM", n/1e6)
    elseif n >= 1e3 then return string.format("%.2fK", n/1e3)
    else return tostring(n) end
end

-------------------------------------------------
-- MAPS
-------------------------------------------------
local ClassMap = {
    [1]="Fighter ü•ä",[2]="Shinobi üåÄ",[3]="Pirate ‚ò†Ô∏è",[4]="Ghoul üëª",[5]="Hero ü¶∏",
    [6]="Reaper ‚ò†Ô∏è",[7]="Saiyan üí•",[8]="Sin üòà",[9]="Magi üßô",[10]="Akuma üò°",
    [11]="Yonko üè¥‚Äç‚ò†Ô∏è",[12]="Gorosei üßì",[13]="Overlord üëë",[14]="Hokage ü¶ä",
    [15]="Kaioshin üëº",[16]="Sage üïäÔ∏è",[17]="Espada ‚öîÔ∏è",[18]="Shinigami üëπ",
    [19]="Hashira ‚öîÔ∏è",[20]="Hakaishin üíÄ",[21]="Otsutsuki üåå",
    [22]="Pirate King üè¥‚Äç‚ò†Ô∏èüëë",[23]="Kishin üëø",[24]="Angel üòá",
    [25]="Demon King üëπ",[26]="Ultra Instinct ‚ú®",[27]="Upper Moon üåô"
}

local StatMap = {
    ["1"]={"Strength","üí™"},
    ["2"]={"Durability","üõ°Ô∏è"},
    ["3"]={"Chakra","üåÄ"},
    ["4"]={"Sword","üó°Ô∏è"},
    ["5"]={"Speed","üí®"},
    ["6"]={"Agility","‚òÅÔ∏è"},
    ["Kill"]={"Kill","üî™"},
}

-------------------------------------------------
-- INFO TAB (ORIGINAL)
-------------------------------------------------
local InfoTab = Window:CreateTab("Info üõ†Ô∏è")

InfoTab:CreateSection("Update Log üìù")
InfoTab:CreateParagraph({
    Title = VERSION,
    Content = [[
‚Ä¢ Full UI restored
‚Ä¢ Live stats fixed
‚Ä¢ Quests & overview stable
‚Ä¢ Event-based updates only
‚Ä¢ Qd / Qn abbreviations fixed
]]
})

InfoTab:CreateSection("Discord üí¨")
InfoTab:CreateParagraph({
    Title = "Dear @"..Player.DisplayName,
    Content = [[
Thank you for using MurzzHub ‚ù§Ô∏è  
Every use motivates future updates!

Suggestions & sneak peeks available on Discord.
]]
})

InfoTab:CreateButton({
    Name = "Join Discord",
    Callback = function()
        setclipboard("DISCORD_LINK_HERE")
    end
})

-------------------------------------------------
-- HOME TAB
-------------------------------------------------
local HomeTab = Window:CreateTab("Home üè†")

HomeTab:CreateSection("Player Data üë§")

local ClassLabel = HomeTab:CreateLabel("Class: ...")
local PowerLabel = HomeTab:CreateLabel("Total Power: ... ‚ö°")
local YenLabel = HomeTab:CreateLabel("Money: ... üí∞")
local ChikaraLabel = HomeTab:CreateLabel("Chikara: ... üíé")

HomeTab:CreateSection("Live Stats üìä")

local StatLabels = {}

for id,data in pairs(StatMap) do
    if id ~= "Kill" then
        local name, emoji = unpack(data)
        local label = HomeTab:CreateLabel(name..": ... "..emoji)
        StatLabels[id] = label

        local stat = StatsFolder:FindFirstChild(id)
        if stat then
            local function update()
                label:Set(name..": "..abbreviate(stat.Value).." "..emoji)
            end
            update()
            stat:GetPropertyChangedSignal("Value"):Connect(update)
        end
    end
end

-- Player data binding
local function bindValue(obj, label, prefix, emoji)
    if not obj then return end
    local function update()
        label:Set(prefix..abbreviate(obj.Value).." "..emoji)
    end
    update()
    obj:GetPropertyChangedSignal("Value"):Connect(update)
end

bindValue(OtherData:FindFirstChild("TotalPower"), PowerLabel, "Total Power: ", "‚ö°")
bindValue(OtherData:FindFirstChild("Yen"), YenLabel, "Money: ", "üí∞")
bindValue(OtherData:FindFirstChild("Chikara"), ChikaraLabel, "Chikara: ", "üíé")

if OtherData:FindFirstChild("Class") then
    local function update()
        ClassLabel:Set("Class: "..(ClassMap[OtherData.Class.Value] or "Unknown ‚ùì"))
    end
    update()
    OtherData.Class:GetPropertyChangedSignal("Value"):Connect(update)
end

-------------------------------------------------
-- QUEST OVERVIEW
-------------------------------------------------
HomeTab:CreateSection("Quests Overview üìå")
local OverviewLabels = {}

-------------------------------------------------
-- QUESTS TAB
-------------------------------------------------
local QuestsTab = Window:CreateTab("Quests üìú")
local QuestLabels = {}

-------------------------------------------------
-- QUEST REFRESH (SAFE)
-------------------------------------------------
local function refreshQuests()
    safeRun(function()
        for _,lbl in pairs(OverviewLabels) do lbl:Set("") end
        for _,group in pairs(QuestLabels) do
            for _,lbl in pairs(group) do lbl:Set("") end
        end

        for _,quest in ipairs(QuestsFolder:GetChildren()) do
            if quest:IsA("Folder") then
                local display = quest.Name:gsub("(%a+)(%d+)", "%1 No.%2")

                if not OverviewLabels[quest] then
                    OverviewLabels[quest] = HomeTab:CreateLabel("")
                end

                local totalReq, totalProg = 0, 0
                local reqs = quest:FindFirstChild("Requirements")

                if reqs then
                    for _,req in ipairs(reqs:GetChildren()) do
                        if req:IsA("IntValue") then
                            totalReq += req.Value
                            local prog = quest:FindFirstChild(req.Name) and quest[req.Name].Value or 0
                            totalProg += math.clamp(prog,0,req.Value)
                        end
                    end
                end

                local percent = totalReq > 0 and math.floor((totalProg/totalReq)*100) or 0
                OverviewLabels[quest]:Set(display.." ("..percent.."%)")

                if not QuestLabels[quest] then
                    QuestLabels[quest] = {}
                    QuestsTab:CreateSection(display.." üìú")
                end

                if reqs then
                    for _,req in ipairs(reqs:GetChildren()) do
                        if req:IsA("IntValue") then
                            if not QuestLabels[quest][req.Name] then
                                QuestLabels[quest][req.Name] = QuestsTab:CreateLabel("")
                            end

                            local prog = quest:FindFirstChild(req.Name) and quest[req.Name].Value or 0
                            local name, emoji = unpack(StatMap[req.Name] or {req.Name,""})
                            QuestLabels[quest][req.Name]:Set(
                                abbreviate(prog).."/"..abbreviate(req.Value)..
                                " "..name.." "..emoji..(prog>=req.Value and " ‚úÖ" or "")
                            )
                        end
                    end
                end
            end
        end
    end)
end

refreshQuests()

QuestsFolder.ChildAdded:Connect(refreshQuests)
QuestsFolder.ChildRemoved:Connect(refreshQuests)

for _,v in ipairs(QuestsFolder:GetDescendants()) do
    if v:IsA("IntValue") then
        v:GetPropertyChangedSignal("Value"):Connect(refreshQuests)
    end
end

-------------------------------------------------
-- AUTO FARMS TAB
-------------------------------------------------
local AutoTab = Window:CreateTab("Auto Farms ‚öôÔ∏è")
AutoTab:CreateSection("Coming Soon üöß")

-------------------------------------------------
-- DONE
-------------------------------------------------
Rayfield:LoadConfiguration()
print("[MurzzHub] "..VERSION.." loaded successfully")
