-- MurzzHub v1.0 Beta
-- Full Stable Build (Home + Live Stats + Quests + Auto Train + Auto Chikara + Auto Quest)
-- Author: Murzay | Animated Numbers + Auto Train + Auto Chikara (auto-click + dynamic cooldown)

-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local OtherData = Player:WaitForChild("OtherData")
local StatsFolder = Player:WaitForChild("Stats")
local QuestsFolder = Player:WaitForChild("Quests")

-------------------------------------------------
-- VERSION
-------------------------------------------------
local VERSION = "v1.0 Beta"

-------------------------------------------------
-- SAFE DEBUG
-------------------------------------------------
local warned = false
local function safeRun(fn)
    local ok, err = pcall(fn)
    if not ok and not warned then
        warned = true
        warn("[MurzzHub Debug] "..err)
    end
end

local function log(msg)
    print("[MurzzHub DEBUG] "..tostring(msg))
end

-------------------------------------------------
-- RAYFIELD
-------------------------------------------------
local Rayfield
repeat
    local success, result = pcall(function()
        return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
    end)
    if success then
        Rayfield = result
    else
        warn("[MurzzHub] Rayfield load failed, retrying...")
        task.wait(0.5)
    end
until Rayfield

local Window = Rayfield:CreateWindow({
    Name = "MurzzHub "..VERSION,
    LoadingTitle = "MurzzHub "..VERSION,
    LoadingSubtitle = "Auto Train, Chikara and more!",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MurzzHub",
        FileName = "AFSE_UI"
    }
})

-------------------------------------------------
-- UTIL (FIXED ABBREVIATION)
-------------------------------------------------
local function abbreviate(n)
    if n >= 1e18 then
        return string.format("%.2fQn", n/1e18)
    elseif n >= 1e15 then
        return string.format("%.2fQd", n/1e15)
    elseif n >= 1e12 then
        return string.format("%.2fT", n/1e12)
    elseif n >= 1e9 then
        return string.format("%.2fB", n/1e9)
    elseif n >= 1e6 then
        return string.format("%.2fM", n/1e6)
    elseif n >= 1e3 then
        return string.format("%.2fK", n/1e3)
    else
        return tostring(n)
    end
end

local function easeOutQuad(t)
    return 1 - (1 - t)^2
end

local function animateNumber(label, startValue, endValue, prefix, emoji, duration)
    duration = duration or 0.5
    local fps = 60
    local steps = math.max(1, math.floor(duration * fps))
    for i = 1, steps do
        local t = easeOutQuad(i/steps)
        local val = startValue + (endValue - startValue) * t
        if label and label.Set then
            label:Set(prefix..abbreviate(math.floor(val)).." "..emoji)
        end
        task.wait(duration/steps)
    end
    if label and label.Set then
        label:Set(prefix..abbreviate(endValue).." "..emoji)
    end
end

-------------------------------------------------
-- MAPS
-------------------------------------------------
local ClassMap = {
    [1]="Fighter ğŸ¥Š",[2]="Shinobi ğŸŒ€",[3]="Pirate â˜ ï¸",[4]="Ghoul ğŸ‘»",[5]="Hero ğŸ¦¸",
    [6]="Reaper â˜ ï¸",[7]="Saiyan ğŸ’¥",[8]="Sin ğŸ˜ˆ",[9]="Magi ğŸ§™",[10]="Akuma ğŸ˜¡",
    [11]="Yonko ğŸ´â€â˜ ï¸",[12]="Gorosei ğŸ§“",[13]="Overlord ğŸ‘‘",[14]="Hokage ğŸ¦Š",
    [15]="Kaioshin ğŸ‘¼",[16]="Sage ğŸ•Šï¸",[17]="Espada âš”ï¸",[18]="Shinigami ğŸ‘¹",
    [19]="Hashira âš”ï¸",[20]="Hakaishin ğŸ’€",[21]="Otsutsuki ğŸŒŒ",
    [22]="Pirate King ğŸ´â€â˜ ï¸ğŸ‘‘",[23]="Kishin ğŸ‘¿",[24]="Angel ğŸ˜‡",
    [25]="Demon King ğŸ‘¹",[26]="Ultra Instinct âœ¨",[27]="Upper Moon ğŸŒ™"
}

local StatMap = {
    ["1"]={"Strength","ğŸ’ª"},
    ["2"]={"Durability","ğŸ›¡ï¸"},
    ["3"]={"Chakra","ğŸŒ€"},
    ["4"]={"Sword","ğŸ—¡ï¸"},
    ["5"]={"Agility","â˜ï¸"},
    ["6"]={"Speed","ğŸ’¨"},
    ["Kill"]={"Kill","ğŸ”ª"},
}

-------------------------------------------------
-- ZONE POSITIONS (ALL STATS)
-------------------------------------------------
local ZonePositions = {

    Strength = {
        ["100"]     = Vector3.new(-1.902, 65.000, 127.968),
        ["10K"]     = Vector3.new(1341.747, 153.963, -137.436),
        ["100K"]    = Vector3.new(-1238.425, 59.000, 476.596),
        ["1M"]      = Vector3.new(-915.294, 83.520, 166.473),
        ["10M"]     = Vector3.new(-2305.319, 617.492, 527.046),
        ["100M"]    = Vector3.new(-39.747, 64.289, -1307.120),
        ["1B"]      = Vector3.new(718.492, 151.251, 924.886),
        ["100B"]    = Vector3.new(1846.949, 141.200, 92.585),
        ["5T"]      = Vector3.new(626.400, 696.623, 429.320),
        ["250T"]    = Vector3.new(4340.031, 60.000, -631.732),
        ["150Qd"]   = Vector3.new(812.393, 207.000, -1001.867),
        ["25Qn"]    = Vector3.new(3873.903, 136.015, 890.458),
        ["10Sx"]    = Vector3.new(3869.009, 1110.712, -1254.075),
    },

    Durability = {
        ["100"]     = Vector3.new(112.002, 56.026, 881.742),
        ["10K"]     = Vector3.new(-1606.842, 61.615, -541.502),
        ["100K"]    = Vector3.new(-72.535, 61.008, 2055.987),
        ["1M"]      = Vector3.new(-619.584, 179.000, 731.073),
        ["10M"]     = Vector3.new(-1119.864, 212.630, -949.097),
        ["100M"]    = Vector3.new(-338.338, 72.620, -1651.415),
        ["1B"]      = Vector3.new(2495.594, 1543.135, -383.322),
        ["100B"]    = Vector3.new(-2678.021, -229.855, 358.415),
        ["5T"]      = Vector3.new(2175.640, 519.579, 571.121),
        ["250T"]    = Vector3.new(1669.455, 432.897, -1345.698),
        ["150Qd"]   = Vector3.new(194.019, 773.591, -701.855),
        ["25Qn"]    = Vector3.new(2564.930, 91.790, 1756.254),
        ["10Sx"]    = Vector3.new(1718.871, 2305.067, -22.188),
    },

    Chakra = {
        ["100"]     = Vector3.new(-6.479, 65.000, -119.760),
        ["10K"]     = Vector3.new(1425.668, 147.000, -581.487),
        ["100K"]    = Vector3.new(915.292, 141.000, 783.253),
        ["1M"]      = Vector3.new(1628.384, 388.750, 591.066),
        ["10M"]     = Vector3.new(336.626, -156.000, -1802.547),
        ["100M"]    = Vector3.new(1027.624, 251.000, -630.809),
        ["1B"]      = Vector3.new(3053.817, 110.900, 1105.384),
        ["100B"]    = Vector3.new(1663.124, 556.154, 1779.387),
        ["5T"]      = Vector3.new(-6.211, 101.133, -480.247),
        ["250T"]    = Vector3.new(-402.687, 1252.990, 668.177),
        ["150Qd"]   = Vector3.new(-768.222, 2792.676, 591.147),
        ["25Qn"]    = Vector3.new(3226.973, -440.978, -244.406),
        ["10Sx"]    = Vector3.new(337.880, 61.008, 1917.442),
    },

    Agility = {
        ["100"]     = Vector3.new(41.676, 69.183, 453.424),
        ["10K"]     = Vector3.new(-424.448, 121.923, -78.950),
        ["100K"]    = Vector3.new(3482.918, 60.000, 130.891),
        ["5M"]      = Vector3.new(4111.682, 60.922, 844.187),
    },

    Speed = {
        ["100"]     = Vector3.new(-109.675, 61.000, -508.852),
        ["10K"]     = Vector3.new(-424.448, 121.923, -78.950),
        ["100K"]    = Vector3.new(3482.918, 60.000, 130.891),
        ["5M"]      = Vector3.new(4111.682, 60.922, 844.187),
    },

    Sword = {
        -- intentionally empty (no zones)
    }
}

-------------------------------------------------
-- INFO TAB
-------------------------------------------------
local InfoTab = Window:CreateTab("Info ğŸ› ï¸")

InfoTab:CreateSection("Update Log ğŸ“")
InfoTab:CreateParagraph({
    Title = VERSION,
    Content = [[
â€¢ Auto Farms complete
â€¢ Teleports Tab in progress
â€¢ Added basic debugging
â€¢ Nearly ready for release!
]]
})

InfoTab:CreateSection("Discord ğŸ’¬")
InfoTab:CreateParagraph({
    Title = "Dear @"..Player.DisplayName..",",
    Content = [[
Thank you for using Murzzhub!
I appreciate every second of you using my script!
If you have any suggestions, or want to see sneak peeks,
Join the discord! (None for now srry!)
]]
})

InfoTab:CreateButton({
    Name = "Join Discord",
    Callback = function()
        setclipboard("No Discord For Now Sorry :(")
    end
})

-------------------------------------------------
-- HOME TAB
-------------------------------------------------
local HomeTab = Window:CreateTab("Home ğŸ ")

HomeTab:CreateSection("Player Data ğŸ‘¤")

local ClassLabel = HomeTab:CreateLabel("Class: ...")
local PowerLabel = HomeTab:CreateLabel("Total Power: ... âš¡")
local YenLabel = HomeTab:CreateLabel("Money: ... ğŸ’°")
local ChikaraLabel = HomeTab:CreateLabel("Chikara: ... ğŸ’")

local function bindValue(obj, label, prefix, emoji)
    if not obj or not label then return end
    local current = obj.Value
    local function update()
        local newVal = obj.Value
        task.spawn(function()
            animateNumber(label, current, newVal, prefix, emoji, 0.7)
            current = newVal
        end)
    end
    update()
    obj:GetPropertyChangedSignal("Value"):Connect(update)
end

bindValue(OtherData:FindFirstChild("TotalPower"), PowerLabel, "Total Power: ", "âš¡")
bindValue(OtherData:FindFirstChild("Yen"), YenLabel, "Money: ", "ğŸ’°")
bindValue(OtherData:FindFirstChild("Chikara"), ChikaraLabel, "Chikara: ", "ğŸ’")

if OtherData:FindFirstChild("Class") then
    local function update()
        ClassLabel:Set("Class: "..(ClassMap[OtherData.Class.Value] or "Unknown â“"))
    end
    update()
    OtherData.Class:GetPropertyChangedSignal("Value"):Connect(update)
end

-------------------------------------------------
-- LIVE STATS
-------------------------------------------------
HomeTab:CreateSection("Live Stats ğŸ“Š")

-- Ordered stats
local OrderedStats = {
    {id = "1", name = "Strength",   emoji = "ğŸ’ª"},
    {id = "2", name = "Durability", emoji = "ğŸ›¡ï¸"},
    {id = "3", name = "Chakra",     emoji = "ğŸŒ€"},
    {id = "6", name = "Speed",      emoji = "ğŸ’¨"},
    {id = "5", name = "Agility",    emoji = "â˜ï¸"},
}

for _, data in ipairs(OrderedStats) do
    local stat = StatsFolder:FindFirstChild(data.id)
    if stat then
        local current = stat.Value
        local label = HomeTab:CreateLabel(data.name..": ... "..data.emoji)

        local function update()
            local newVal = stat.Value
            task.spawn(function()
                animateNumber(label, current, newVal, data.name..": ", data.emoji, 0.7)
                current = newVal
            end)
        end

        update()
        stat:GetPropertyChangedSignal("Value"):Connect(update)
    end
end

-------------------------------------------------
-- QUESTS TAB
-------------------------------------------------
local QuestsTab = Window:CreateTab("Quests ğŸ“œ")

local function setupQuest(quest)
    safeRun(function()
        local display = quest.Name:gsub("(%a+)(%d+)", "%1 No.%2")
        QuestsTab:CreateSection(display.." ğŸ“œ")

        local reqs = quest:FindFirstChild("Requirements")
        if not reqs then return end

        for _,req in ipairs(reqs:GetChildren()) do
            if req:IsA("IntValue") or req:IsA("NumberValue") then
                local label = QuestsTab:CreateLabel("...")

                local current = 0
                local function update()
                    local progress = 0
                    if quest:FindFirstChild(req.Name) then
                        progress = quest[req.Name].Value
                    elseif quest:FindFirstChild("Progress")
                        and quest.Progress:FindFirstChild(req.Name) then
                        progress = quest.Progress[req.Name].Value
                    end

                    local name, emoji = req.Name, ""
                    if StatMap[req.Name] then
                        name, emoji = unpack(StatMap[req.Name])
                    end

                    local done = progress >= req.Value

                    task.spawn(function()
                        local steps = 30
                        local duration = 0.7
                        for i = 1, steps do
                            local t = easeOutQuad(i/steps)
                            local val = current + (progress - current) * t
                            label:Set(string.format("%s/%s %s %s%s",
                                abbreviate(math.floor(val)),
                                abbreviate(req.Value),
                                name,
                                emoji,
                                done and " âœ…" or ""
                            ))
                            task.wait(duration/steps)
                        end
                        label:Set(string.format("%s/%s %s %s%s",
                            abbreviate(progress),
                            abbreviate(req.Value),
                            name,
                            emoji,
                            done and " âœ…" or ""
                        ))
                        current = progress
                    end)
                end

                update()

                if quest:FindFirstChild(req.Name) then
                    quest[req.Name]:GetPropertyChangedSignal("Value"):Connect(update)
                end
                if quest:FindFirstChild("Progress")
                    and quest.Progress:FindFirstChild(req.Name) then
                    quest.Progress[req.Name]:GetPropertyChangedSignal("Value"):Connect(update)
                end
            end
        end
    end)
end

for _,q in ipairs(QuestsFolder:GetChildren()) do
    if q:IsA("Folder") then setupQuest(q) end
end

-------------------------------------------------
-- AUTO FARMS TAB
-------------------------------------------------
local AutoTab = Window:CreateTab("Auto Farms âš™ï¸")

-- Auto Train Section
AutoTab:CreateSection("Auto Train ğŸ‹ï¸")

local mainClient = Player:WaitForChild("PlayerGui"):WaitForChild("Main"):WaitForChild("MainClient")
local StatFunctions = require(mainClient:WaitForChild("StatFunctions"))
local CharacterModule
repeat
    CharacterModule = StatFunctions.characterModule
    task.wait(0.1)
until CharacterModule

local GameData = require(ReplicatedStorage:WaitForChild("Modules"):WaitForChild("GameData"))

local AutoStats = {
    {1, "Strength", "ğŸ’ª"},
    {2, "Durability", "ğŸ›¡ï¸"},
    {3, "Chakra", "ğŸŒ€"},
    {4, "Sword", "ğŸ—¡ï¸"},
    {5, "Agility", "â˜ï¸"},
    {6, "Speed", "ğŸ’¨"},
}

local ActiveTrains = {}
local LastFire = {}

for _,stat in ipairs(AutoStats) do
    local statID, name, emoji = unpack(stat)
    AutoTab:CreateToggle({
        Name = "Train "..name.." "..emoji,
        CurrentValue = false,
        Flag = name.."Toggle",
        Callback = function(val)
            if val then
                if ActiveTrains[statID] then return end
                ActiveTrains[statID] = true
                LastFire[statID] = 0
                task.spawn(function()
                    while ActiveTrains[statID] do
                        if CharacterModule.states.Dead then
                            task.wait(1)
                        else
                            CharacterModule.characterStopped = false
                            CharacterModule:ResumeCharacter()
                            StatFunctions.CurrentKey = statID
                            StatFunctions[statID] = false

                            local cooldown = GameData.Stats[statID].Cooldown or 0.1
                            local now = tick()
                            if now - LastFire[statID] >= cooldown then
                                local success, err = pcall(function()
                                    ReplicatedStorage.Remotes.RemoteEvent:FireServer("Train", statID)
                                end)
                                if success then
                                    log("TrainStat fired for "..name)
                                else
                                    log("TrainStat error: "..tostring(err))
                                end
                                LastFire[statID] = tick()
                            end
                            task.wait(0.05)
                        end
                    end
                    ActiveTrains[statID] = nil
                end)
            else
                ActiveTrains[statID] = false
            end
        end
    })
end

-- Auto Chikara Section (ClickBox + ClickDetector)
AutoTab:CreateSection("Auto Chikara ğŸ’ | AUTOCLICKER NEEDED")

local AutoChikaraActive = false

AutoTab:CreateToggle({
    Name = "Collect Chikara âš ï¸",
    CurrentValue = false,
    Flag = "AutoChikaraToggle",
    Callback = function(val)
        AutoChikaraActive = val
        if val then
            log("Auto Chikara ON")
            task.spawn(function()
                local lastCollected = {}
                while AutoChikaraActive do
                    local cratesFolder = workspace:FindFirstChild("Scriptable") and workspace.Scriptable:FindFirstChild("ChikaraBoxes")
                    if cratesFolder then
                        local crates = cratesFolder:GetChildren()
                        local hasCollected = false
                        for _, crate in ipairs(crates) do
                            if not AutoChikaraActive then break end
                            if crate and crate:IsA("BasePart") then
                                local clickBox = crate:FindFirstChild("ClickBox")
                                if clickBox then
                                    local clickDetector = clickBox:FindFirstChildWhichIsA("ClickDetector")
                                    local now = tick()
                                    if clickDetector and (not lastCollected[crate] or now - lastCollected[crate] >= 10) then
                                        if Player.Character and Player.Character.PrimaryPart then
                                            Player.Character:SetPrimaryPartCFrame(crate.CFrame + Vector3.new(0,3,0))
                                        end
                                        task.wait(0.1)
                                        local success, err = pcall(function()
                                            clickDetector:FireClick(Player)
                                        end)
                                        if success then
                                            lastCollected[crate] = tick()
                                            hasCollected = true
                                            log("[AutoChikara] Collected crate")
                                        else
                                            warn("[AutoChikara] Failed to collect: "..tostring(err))
                                        end
                                        task.wait(10)
                                    end
                                end
                            end
                        end
                        if not hasCollected then task.wait(1) end
                    else
                        task.wait(1)
                    end
                end
                log("Auto Chikara OFF")
            end)
        else
            log("Auto Chikara OFF")
        end
    end
})

-------------------------------------------------
-- TELEPORTS TAB
-------------------------------------------------
local TeleportsTab = Window:CreateTab("Teleports ğŸ“")
TeleportsTab:CreateSection("Stat-Based Zones")

local function getCharacter()
    return Player.Character or Player.CharacterAdded:Wait()
end

local function teleportTo(position)
    local char = getCharacter()
    if char and char.PrimaryPart then
        char:SetPrimaryPartCFrame(CFrame.new(position + Vector3.new(0, 5, 0)))
    end
end

-- parse zone keys like "10K", "5T", "150Qd"
local function parseZoneValue(text)
    local number, suffix = text:match("([%d%.]+)(%a*)")
    number = tonumber(number)
    if not number then return 0 end

    local mult = {
        K  = 1e3,
        M  = 1e6,
        B  = 1e9,
        T  = 1e12,
        Qd = 1e15,
        Qn = 1e18,
        Sx = 1e21,
    }

    return number * (mult[suffix] or 1)
end

local function getBestZone(statName, statValue)
    local zones = ZonePositions[statName]
    if not zones then return nil end

    local bestRequirement = 0
    local bestPosition = nil

    for requirement, position in pairs(zones) do
        local needed = parseZoneValue(requirement)
        if statValue >= needed and needed >= bestRequirement then
            bestRequirement = needed
            bestPosition = position
        end
    end

    return bestPosition
end

-- Ordered Stat Buttons (list ensures order)
local StatButtonsOrdered = {
    {Name = "Strength",   id = "1", emoji = "ğŸ’ª"},
    {Name = "Durability", id = "2", emoji = "ğŸ›¡ï¸"},
    {Name = "Chakra",     id = "3", emoji = "ğŸŒ€"},
    {Name = "Speed",      id = "6", emoji = "ğŸ’¨"},
    {Name = "Agility",    id = "5", emoji = "â˜ï¸"},
}

-- Create buttons in exact order
for i = 1, #StatButtonsOrdered do
    local data = StatButtonsOrdered[i]
    local stat = Player.Stats:FindFirstChild(data.id)
    if stat then
        local currentZone

        -- Create button
        local button = TeleportsTab:CreateButton({
            Name = data.Name.." "..data.emoji,
            Callback = function()
                if currentZone then
                    teleportTo(currentZone)
                end
            end
        })

        -- Update zone when stat changes
        local function updateZone()
            currentZone = getBestZone(data.Name, stat.Value)
        end

        updateZone()
        stat:GetPropertyChangedSignal("Value"):Connect(updateZone)
    end
end
