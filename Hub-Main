-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local Player = Players.LocalPlayer
local OtherData = Player:WaitForChild("OtherData")
local QuestsFolder = Player:WaitForChild("Quests")

-------------------------------------------------
-- RAYFIELD LOAD (NO CREATELOADER)
-------------------------------------------------
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "MurzzHub v1.0",
    LoadingTitle = "MurzzHub v1.0",
    LoadingSubtitle = "Auto Train â€¢ Teleports",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MurzzHub",
        FileName = "AFSE"
    },
    KeySystem = false
})

-------------------------------------------------
-- UTILITIES
-------------------------------------------------
local function formatNumber(num)
    if not num then return "0" end
    local t = {
        {1e15,"Qd"},
        {1e12,"T"},
        {1e9,"B"},
        {1e6,"M"},
        {1e3,"K"}
    }
    for _,v in ipairs(t) do
        if num >= v[1] then
            return string.format("%.2f%s", num/v[1], v[2])
        end
    end
    return tostring(num)
end

-------------------------------------------------
-- STAT MAPS
-------------------------------------------------
local StatIdToName = {
    [1] = "Strength",
    [2] = "Durability",
    [3] = "Chakra",
    [4] = "Sword",
    [5] = "Speed",
    [6] = "Agility"
}

-------------------------------------------------
-- HOME TAB
-------------------------------------------------
local HomeTab = Window:CreateTab("Home ğŸ ")

HomeTab:CreateSection("Player Data ğŸ‘¤")

local ClassLabel    = HomeTab:CreateLabel("Class: ...")
local PowerLabel    = HomeTab:CreateLabel("Total Power: ... âš¡")
local YenLabel      = HomeTab:CreateLabel("Money: ... ğŸ’°")
local ChikaraLabel  = HomeTab:CreateLabel("Chikara: ... ğŸ’")

HomeTab:CreateSection("Live Stats ğŸ“Š")

local LiveStats = {
    Strength   = HomeTab:CreateLabel("Strength: ... ğŸ’ª"),
    Durability = HomeTab:CreateLabel("Durability: ... ğŸ›¡ï¸"),
    Chakra     = HomeTab:CreateLabel("Chakra: ... ğŸŒ€"),
    Sword      = HomeTab:CreateLabel("Sword: ... ğŸ—¡ï¸"),
    Speed      = HomeTab:CreateLabel("Speed: ... ğŸ’¨"),
    Agility    = HomeTab:CreateLabel("Agility: ... â˜ï¸"),
}

HomeTab:CreateSection("Active Quest Preview ğŸ“œ")
local QuestPreview = HomeTab:CreateLabel("No active quest")

-------------------------------------------------
-- QUEST TAB
-------------------------------------------------
local QuestTab = Window:CreateTab("Quests ğŸ“œ")
QuestTab:CreateSection("Current Quest")

local QuestTitle = QuestTab:CreateLabel("Waiting for quest...")
local QuestBars = {}

-------------------------------------------------
-- CREATE PROGRESS BAR (SAFE)
-------------------------------------------------
local function createQuestBar(statName)
    return QuestTab:CreateSlider({
        Name = statName,
        Range = {0, 100},
        Increment = 1,
        CurrentValue = 0,
        Callback = function() end
    })
end

-------------------------------------------------
-- BUILD QUEST UI
-------------------------------------------------
local function buildQuestUI(quest)
    QuestBars = {}

    if not quest then
        QuestTitle:Set("No active quest âŒ")
        QuestPreview:Set("No active quest")
        return
    end

    QuestTitle:Set("Quest: "..quest.Name.." ğŸ“œ")
    QuestPreview:Set("Active: "..quest.Name)

    local progress = quest:FindFirstChild("Progress")
    local requirements = quest:FindFirstChild("Requirements")
    if not progress or not requirements then return end

    for _,p in ipairs(progress:GetChildren()) do
        if not p:IsA("IntValue") then continue end

        local statId = tonumber(p.Name)
        local statName = StatIdToName[statId]
        local req = requirements:FindFirstChild(p.Name)

        if statName and req then
            QuestBars[p] = {
                Bar = createQuestBar(statName),
                Progress = p,
                Requirement = req,
                Name = statName
            }
        end
    end
end

-------------------------------------------------
-- LIVE QUEST UPDATE
-------------------------------------------------
RunService.Heartbeat:Connect(function()
    for _,data in pairs(QuestBars) do
        local p = data.Progress
        local r = data.Requirement
        if p and r then
            local percent = math.clamp(p.Value / r.Value, 0, 1)
            data.Bar:Set({
                Name = data.Name.." "..formatNumber(p.Value).."/"..formatNumber(r.Value),
                CurrentValue = math.floor(percent * 100)
            })
        end
    end
end)

-------------------------------------------------
-- QUEST DETECTION (BOOM / GIOVANNI / SWORD MASTER)
-------------------------------------------------
task.spawn(function()
    local lastQuest
    while true do
        local foundQuest

        for _,q in ipairs(QuestsFolder:GetChildren()) do
            if q:IsA("Folder") and q:FindFirstChild("Progress") then
                foundQuest = q
                break
            end
        end

        if foundQuest ~= lastQuest then
            buildQuestUI(foundQuest)
            lastQuest = foundQuest
        end

        task.wait(0.5)
    end
end)

-------------------------------------------------
-- HOME LIVE UPDATES
-------------------------------------------------
RunService.Heartbeat:Connect(function()
    if OtherData:FindFirstChild("TotalPower") then
        PowerLabel:Set("Total Power: "..formatNumber(OtherData.TotalPower.Value).." âš¡")
    end
    if OtherData:FindFirstChild("Yen") then
        YenLabel:Set("Money: "..formatNumber(OtherData.Yen.Value).." ğŸ’°")
    end
    if OtherData:FindFirstChild("Chikara") then
        ChikaraLabel:Set("Chikara: "..formatNumber(OtherData.Chikara.Value).." ğŸ’")
    end

    for stat,label in pairs(LiveStats) do
        local obj = OtherData:FindFirstChild(stat)
        if obj then
            label:Set(stat..": "..formatNumber(obj.Value))
        end
    end
end)

-------------------------------------------------
Rayfield:LoadConfiguration()
