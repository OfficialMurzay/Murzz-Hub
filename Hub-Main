-- MurzzHub v1.0o Beta (UI + Player Data, Stats & Quest Overview + Info Tab + Quests Tab)
-- Author: Murzay (Modified by ChatGPT)
-- VERSION NOTE: v1.0n -> v1.0o

-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer
local OtherData = Player:WaitForChild("OtherData")
local StatsFolder = Player:WaitForChild("Stats")
local QuestsFolder = Player:WaitForChild("Quests")

-------------------------------------------------
-- VERSION
-------------------------------------------------
local VERSION = "v1.0o Beta"

-------------------------------------------------
-- DEBUG SYSTEM
-------------------------------------------------
local debugErrorShown = false
local function safeRun(func)
    local ok, err = pcall(func)
    if not ok and not debugErrorShown then
        debugErrorShown = true
        warn("[MurzzHub Debug] An error occurred:\n"..err)
    end
end

-------------------------------------------------
-- RAYFIELD
-------------------------------------------------
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "MurzzHub "..VERSION,
    LoadingTitle = "MurzzHub "..VERSION,
    LoadingSubtitle = VERSION.." - UI Live Player Data, Stats & Quests",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MurzzHub",
        FileName = "AFSE_UI"
    },
    KeySystem = false
})

-------------------------------------------------
-- UTILITIES
-------------------------------------------------
local function abbreviateNumber(num)
    if not num then return "0" end
    local absNum = math.abs(num)
    if absNum >= 1e21 then return string.format("%.2fSx", num/1e21)
    elseif absNum >= 1e18 then return string.format("%.2fQn", num/1e18)
    elseif absNum >= 1e15 then return string.format("%.2fQd", num/1e15)
    elseif absNum >= 1e12 then return string.format("%.2fT", num/1e12)
    elseif absNum >= 1e9 then return string.format("%.2fB", num/1e9)
    elseif absNum >= 1e6 then return string.format("%.2fM", num/1e6)
    elseif absNum >= 1e3 then return string.format("%.2fK", num/1e3)
    else return tostring(num) end
end

local function animateValue(label, startVal, endVal, prefix, emoji, duration)
    if startVal == endVal then return end
    local step = (endVal - startVal)/(duration*30)
    local current = startVal
    local connection
    connection = RunService.RenderStepped:Connect(function()
        current = current + step
        if (step > 0 and current >= endVal) or (step < 0 and current <= endVal) then
            current = endVal
            connection:Disconnect()
        end
        if label and label.Set then label:Set(prefix..abbreviateNumber(math.floor(current)).." "..emoji) end
    end)
end

-------------------------------------------------
-- CLASS MAP
-------------------------------------------------
local ClassMap = {
    [1]="Fighter ü•ä",[2]="Shinobi üåÄ",[3]="Pirate ‚ò†Ô∏è",[4]="Ghoul üëª",[5]="Hero ü¶∏",
    [6]="Reaper ‚ò†Ô∏è",[7]="Saiyan üí•",[8]="Sin üòà",[9]="Magi üßô",[10]="Akuma üò°",
    [11]="Yonko üè¥‚Äç‚ò†Ô∏è",[12]="Gorosei üßì",[13]="Overlord üëë",[14]="Hokage ü¶ä",
    [15]="Kaioshin üëº",[16]="Sage üïäÔ∏è",[17]="Espada ‚öîÔ∏è",[18]="Shinigami üëπ",
    [19]="Hashira ‚öîÔ∏è",[20]="Hakaishin üíÄ",[21]="Otsutsuki üåå",
    [22]="Pirate King üè¥‚Äç‚ò†Ô∏èüëë",[23]="Kishin üëø",[24]="Angel üòá",
    [25]="Demon King üëπ",[26]="Ultra Instinct ‚ú®",[27]="Upper Moon üåô"
}

-------------------------------------------------
-- STAT MAP
-------------------------------------------------
local StatIdToName = {
    [1]="Strength üí™",[2]="Durability üõ°Ô∏è",[3]="Chakra üåÄ",[4]="Sword üó°Ô∏è",[5]="Speed üí®",[6]="Agility ‚òÅÔ∏è"
}

-------------------------------------------------
-- INFO TAB
-------------------------------------------------
local InfoTab = Window:CreateTab("Info üõ†Ô∏è")
InfoTab:CreateSection("Update Log üìù")
InfoTab:CreateParagraph({
    Title = "Update Log "..VERSION..": Quests Tab üìù",
    Content = "Added dedicated Quests tab with live stat progress, abbreviated numbers, completion notifications, and fixed Home tab and Info tab layout."
})

InfoTab:CreateSection("Discord üí¨")
InfoTab:CreateParagraph({
    Title = "Dear @"..Player.DisplayName,
    Content = [[
Thank you for using my script! Every use really supports me, and gives me motivation to continue updating this script!
If you have any suggestions, or just want to see sneak peaks, events and more then join the Discord Server! ‚ù§Ô∏è - Murzay (Scripter)
]]
})
InfoTab:CreateButton({
    Name = "Join The Discord Server!",
    Callback = function()
        safeRun(function()
            local discordLink = "DISCORD_LINK_HERE"
            if discordLink and discordLink ~= "" then
                if syn and syn.request then
                    syn.request({Url=discordLink})
                else
                    setclipboard(discordLink)
                end
            end
        end)
    end
})

-------------------------------------------------
-- HOME TAB
-------------------------------------------------
local HomeTab = Window:CreateTab("Home üè†")
HomeTab:CreateSection("Player Data üë§")
local ClassLabel = HomeTab:CreateLabel("Class: ...")
local PowerLabel = HomeTab:CreateLabel("Total Power: ... ‚ö°")
local YenLabel = HomeTab:CreateLabel("Money: ... üí∞")
local ChikaraLabel = HomeTab:CreateLabel("Chikara: ... üíé")

HomeTab:CreateSection("Live Stats üìä")
local LiveStats = {}
for statId, name in pairs(StatIdToName) do
    local statName, emoji = name:match("^(.-) (.+)$")
    LiveStats[statId] = {Label=HomeTab:CreateLabel(statName..": ... "..emoji), Value=0, Emoji=emoji, StatName=statName}
end

HomeTab:CreateSection("Quest Overview üìú")
local QuestOverviewLabels = {}
local function createQuestLabel(questFolder)
    safeRun(function()
        if not questFolder then return end
        local displayName = questFolder.Name
        local name, number = displayName:match("(%a+)(%d+)")
        if name and number then displayName = name.." No."..number end
        if not QuestOverviewLabels[questFolder.Name] then
            local label = HomeTab:CreateLabel(displayName.." [0%]")
            QuestOverviewLabels[questFolder.Name]={Label=label, Completed=false}
        end
    end)
end
for _, questFolder in ipairs(QuestsFolder:GetChildren()) do createQuestLabel(questFolder) end
QuestsFolder.ChildAdded:Connect(function(child)
    if child:IsA("Folder") then createQuestLabel(child) end
end)

-------------------------------------------------
-- QUESTS TAB
-------------------------------------------------
local QuestsTab = Window:CreateTab("Quests üìú")
QuestsTab:CreateSection("Current Quests üìå")
local QuestParagraphs = {}

local function updateQuestParagraph(questFolder)
    safeRun(function()
        if not questFolder then return end
        local displayName = questFolder.Name
        local name, number = displayName:match("(%a+)(%d+)")
        if name and number then displayName = name.." No."..number end

        local Requirements = questFolder:FindFirstChild("Requirements")
        local Progress = questFolder:FindFirstChild("Progress")
        if not Requirements or not Progress then return end

        local descLines = {}
        local allComplete = true
        for _, req in ipairs(Requirements:GetChildren()) do
            local progVal = 0
            local prog = Progress:FindFirstChild(req.Name)

            if req:IsA("IntValue") or req:IsA("NumberValue") then
                if prog then progVal = prog.Value end
                local statComplete = progVal >= req.Value
                if not statComplete then allComplete = false end

                local fullName = StatIdToName[tonumber(req.Name)] or req.Name
                local statName, emoji = fullName:match("^(.-) (.+)$")
                statName = statName or fullName
                emoji = emoji or ""
                local line = string.format("%s/%s %s %s%s", abbreviateNumber(progVal), abbreviateNumber(req.Value), statName, emoji, statComplete and " ‚úÖ" or "")
                table.insert(descLines, line)
            end
        end

        local descText = table.concat(descLines,"\n")
        local titleText = displayName..(allComplete and " ‚úÖ" or "")

        -- CREATE OR UPDATE PARAGRAPH
        if not QuestParagraphs[questFolder.Name] then
            local paragraph = QuestsTab:CreateParagraph({Title=titleText, Content=descText})
            QuestParagraphs[questFolder.Name] = paragraph
            paragraph.Completed = allComplete
        else
            local paragraph = QuestParagraphs[questFolder.Name]
            if paragraph and paragraph.Set then paragraph:Set(descText) end
            if paragraph then paragraph.Title = titleText end
            paragraph.Completed = allComplete
        end

        -- QUEST COMPLETION NOTIFICATION
        if allComplete then
            local paragraph = QuestParagraphs[questFolder.Name]
            if paragraph and not paragraph.Notified then
                paragraph.Notified = true
                Rayfield:Notify({
                    Title="‚úÖ You completed a quest!",
                    Content="You completed "..displayName.."! Stay on that grinding streak!",
                    Duration=5,
                    Image=1580567251
                })
            end
        end
    end)
end

-- INITIAL PARAGRAPHS
for _, questFolder in ipairs(QuestsFolder:GetChildren()) do updateQuestParagraph(questFolder) end
QuestsFolder.ChildAdded:Connect(function(child) if child:IsA("Folder") then updateQuestParagraph(child) end end)

-- LIVE UPDATE LOOP
RunService.Heartbeat:Connect(function()
    safeRun(function()
        -- PLAYER DATA LIVE
        if OtherData:FindFirstChild("Class") then
            ClassLabel:Set("Class: "..(ClassMap[OtherData.Class.Value] or "Unknown ‚ùì"))
        end
        if OtherData:FindFirstChild("TotalPower") then
            animateValue(PowerLabel,PowerLabel.Value or 0,OtherData.TotalPower.Value,"Total Power: ","‚ö°",0.5)
        end
        if OtherData:FindFirstChild("Yen") then
            animateValue(YenLabel,YenLabel.Value or 0,OtherData.Yen.Value,"Money: ","üí∞",0.5)
        end
        if OtherData:FindFirstChild("Chikara") then
            animateValue(ChikaraLabel,ChikaraLabel.Value or 0,OtherData.Chikara.Value,"Chikara: ","üíé",0.5)
        end

        -- LIVE STATS
        for statId,data in pairs(LiveStats) do
            local statObj = StatsFolder:FindFirstChild(tostring(statId))
            if statObj and statObj.Value ~= data.Value then
                animateValue(data.Label,data.Value,statObj.Value,data.StatName..": ",data.Emoji,0.5)
                data.Value = statObj.Value
            end
        end

        -- QUESTS TAB LIVE UPDATE
        for questName, paragraph in pairs(QuestParagraphs) do
            local questFolder = QuestsFolder:FindFirstChild(questName)
            if questFolder then updateQuestParagraph(questFolder) end
        end
    end)
end)

-------------------------------------------------
-- DONE
-------------------------------------------------
Rayfield:LoadConfiguration()
print("[MurzzHub] UI + Player Data, Stats & Quest Overview + Quests Tab "..VERSION.." loaded successfully")
