-- MurzzHub v1.0r Beta
-- Full Stable Build (Info + Home + Live Quests + Overview)
-- Author: Murzay | Patched Safely

-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local OtherData = Player:WaitForChild("OtherData")
local StatsFolder = Player:WaitForChild("Stats")
local QuestsFolder = Player:WaitForChild("Quests")

-------------------------------------------------
-- VERSION
-------------------------------------------------
local VERSION = "v1.0r Beta"

-------------------------------------------------
-- SAFE DEBUG
-------------------------------------------------
local warned = false
local function safeRun(fn)
    local ok, err = pcall(fn)
    if not ok and not warned then
        warned = true
        warn("[MurzzHub Debug] "..err)
    end
end

-------------------------------------------------
-- RAYFIELD
-------------------------------------------------
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "MurzzHub "..VERSION,
    LoadingTitle = "MurzzHub "..VERSION,
    LoadingSubtitle = "Stable Live Player Data & Quests",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MurzzHub",
        FileName = "AFSE_UI"
    }
})

-------------------------------------------------
-- UTIL
-------------------------------------------------
local function abbreviate(n)
    if n >= 1e12 then return string.format("%.2fT", n/1e12)
    elseif n >= 1e9 then return string.format("%.2fB", n/1e9)
    elseif n >= 1e6 then return string.format("%.2fM", n/1e6)
    elseif n >= 1e3 then return string.format("%.2fK", n/1e3)
    else return tostring(n) end
end

-------------------------------------------------
-- MAPS
-------------------------------------------------
local ClassMap = {
    [1]="Fighter ðŸ¥Š",[2]="Shinobi ðŸŒ€",[3]="Pirate â˜ ï¸",[4]="Ghoul ðŸ‘»",[5]="Hero ðŸ¦¸",
    [6]="Reaper â˜ ï¸",[7]="Saiyan ðŸ’¥",[8]="Sin ðŸ˜ˆ",[9]="Magi ðŸ§™",[10]="Akuma ðŸ˜¡",
    [11]="Yonko ðŸ´â€â˜ ï¸",[12]="Gorosei ðŸ§“",[13]="Overlord ðŸ‘‘",[14]="Hokage ðŸ¦Š",
    [15]="Kaioshin ðŸ‘¼",[16]="Sage ðŸ•Šï¸",[17]="Espada âš”ï¸",[18]="Shinigami ðŸ‘¹",
    [19]="Hashira âš”ï¸",[20]="Hakaishin ðŸ’€",[21]="Otsutsuki ðŸŒŒ",
    [22]="Pirate King ðŸ´â€â˜ ï¸ðŸ‘‘",[23]="Kishin ðŸ‘¿",[24]="Angel ðŸ˜‡",
    [25]="Demon King ðŸ‘¹",[26]="Ultra Instinct âœ¨",[27]="Upper Moon ðŸŒ™"
}

local StatMap = {
    ["1"]={"Strength","ðŸ’ª"},
    ["2"]={"Durability","ðŸ›¡ï¸"},
    ["3"]={"Chakra","ðŸŒ€"},
    ["4"]={"Sword","ðŸ—¡ï¸"},
    ["5"]={"Speed","ðŸ’¨"},
    ["6"]={"Agility","â˜ï¸"},
    ["Kill"]={"Kill","ðŸ”ª"},
}

-------------------------------------------------
-- INFO TAB (FIRST)
-------------------------------------------------
local InfoTab = Window:CreateTab("Info ðŸ› ï¸")

InfoTab:CreateSection("Update Log ðŸ“")
InfoTab:CreateParagraph({
    Title = VERSION,
    Content = [[
â€¢ Quests Overview added to Home
â€¢ Live % tracking per quest
â€¢ Emojis standardized (right-side)
â€¢ Kill quests fully supported
â€¢ Event-based (zero loops)
â€¢ UI locked & stable
]]
})

InfoTab:CreateSection("Discord ðŸ’¬")
InfoTab:CreateParagraph({
    Title = "Dear @"..Player.DisplayName,
    Content = [[
Thank you for using MurzzHub â¤ï¸  
Every use motivates future updates!

Suggestions, sneak peeks & events:
]]
})

InfoTab:CreateButton({
    Name = "Join Discord",
    Callback = function()
        setclipboard("DISCORD_LINK_HERE")
    end
})

-------------------------------------------------
-- HOME TAB
-------------------------------------------------
local HomeTab = Window:CreateTab("Home ðŸ ")

HomeTab:CreateSection("Player Data ðŸ‘¤")

local ClassLabel = HomeTab:CreateLabel("Class: ...")
local PowerLabel = HomeTab:CreateLabel("Total Power: ... âš¡")
local YenLabel = HomeTab:CreateLabel("Money: ... ðŸ’°")
local ChikaraLabel = HomeTab:CreateLabel("Chikara: ... ðŸ’Ž")

HomeTab:CreateSection("Live Stats ðŸ“Š")

for id,data in pairs(StatMap) do
    if tonumber(id) then
        local name, emoji = unpack(data)
        local label = HomeTab:CreateLabel(name..": ... "..emoji)
        local stat = StatsFolder:FindFirstChild(id)
        if stat then
            local function update()
                label:Set(name..": "..abbreviate(stat.Value).." "..emoji)
            end
            update()
            stat:GetPropertyChangedSignal("Value"):Connect(update)
        end
    end
end

-------------------------------------------------
-- QUEST OVERVIEW ðŸ“Œ
-------------------------------------------------
HomeTab:CreateSection("Quests Overview ðŸ“Œ")
local OverviewLabels = {}

local function bindOverview(quest)
    local display = quest.Name:gsub("(%a+)(%d+)", "%1 No.%2")
    local label = HomeTab:CreateLabel(display.." (0%)")
    OverviewLabels[quest] = label

    local function recalc()
        local reqs = quest:FindFirstChild("Requirements")
        if not reqs then return end

        local totalReq, totalProg = 0, 0

        for _,req in ipairs(reqs:GetChildren()) do
            if req:IsA("IntValue") or req:IsA("NumberValue") then
                totalReq += req.Value
                local prog = 0
                if quest:FindFirstChild(req.Name) then
                    prog = quest[req.Name].Value
                elseif quest:FindFirstChild("Progress")
                    and quest.Progress:FindFirstChild(req.Name) then
                    prog = quest.Progress[req.Name].Value
                end
                totalProg += math.clamp(prog,0,req.Value)
            end
        end

        local percent = totalReq > 0 and math.floor((totalProg/totalReq)*100) or 0
        label:Set(display.." ("..percent.."%)")
    end

    recalc()

    for _,obj in ipairs(quest:GetDescendants()) do
        if obj:IsA("IntValue") or obj:IsA("NumberValue") then
            obj:GetPropertyChangedSignal("Value"):Connect(recalc)
        end
    end
end

for _,q in ipairs(QuestsFolder:GetChildren()) do
    if q:IsA("Folder") then bindOverview(q) end
end

-------------------------------------------------
-- QUESTS TAB
-------------------------------------------------
local QuestsTab = Window:CreateTab("Quests ðŸ“Œ")

local function setupQuest(quest)
    safeRun(function()
        local display = quest.Name:gsub("(%a+)(%d+)", "%1 No.%2")
        QuestsTab:CreateSection(display.." ðŸ“Œ")

        local reqs = quest:FindFirstChild("Requirements")
        if not reqs then return end

        for _,req in ipairs(reqs:GetChildren()) do
            if req:IsA("IntValue") or req:IsA("NumberValue") then
                local label = QuestsTab:CreateLabel("...")

                local function update()
                    local progress = 0
                    if quest:FindFirstChild(req.Name) then
                        progress = quest[req.Name].Value
                    elseif quest:FindFirstChild("Progress")
                        and quest.Progress:FindFirstChild(req.Name) then
                        progress = quest.Progress[req.Name].Value
                    end

                    local name, emoji = req.Name, ""
                    if StatMap[req.Name] then
                        name, emoji = unpack(StatMap[req.Name])
                    end

                    local done = progress >= req.Value
                    label:Set(
                        abbreviate(progress).."/"..abbreviate(req.Value)..
                        " "..name.." "..emoji..(done and " âœ…" or "")
                    )
                end

                update()

                if quest:FindFirstChild(req.Name) then
                    quest[req.Name]:GetPropertyChangedSignal("Value"):Connect(update)
                end
                if quest:FindFirstChild("Progress")
                    and quest.Progress:FindFirstChild(req.Name) then
                    quest.Progress[req.Name]:GetPropertyChangedSignal("Value"):Connect(update)
                end
            end
        end
    end)
end

for _,q in ipairs(QuestsFolder:GetChildren()) do
    if q:IsA("Folder") then setupQuest(q) end
end

-------------------------------------------------
-- AUTO FARMS TAB
-------------------------------------------------
local AutoTab = Window:CreateTab("Auto Farms ðŸ¤–")
AutoTab:CreateSection("Coming Soon ðŸš§")
AutoTab:CreateLabel("â€¢ Auto Train")
AutoTab:CreateLabel("â€¢ Auto Quest")
AutoTab:CreateLabel("â€¢ Smart Zone Detection")

-------------------------------------------------
-- DONE
-------------------------------------------------
Rayfield:LoadConfiguration()
print("[MurzzHub] "..VERSION.." loaded successfully")
