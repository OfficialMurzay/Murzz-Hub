-- MurzzHub v1.0t Beta
-- Quest Overview Added (Home Tab)
-- Tick rule enforced (ALWAYS LAST)
-- Author: Murzay

-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local OtherData = Player:WaitForChild("OtherData")
local StatsFolder = Player:WaitForChild("Stats")
local QuestsFolder = Player:WaitForChild("Quests")

-------------------------------------------------
-- VERSION
-------------------------------------------------
local VERSION = "v1.0t Beta"

-------------------------------------------------
-- SAFE DEBUG
-------------------------------------------------
local warned = false
local function safeRun(fn)
    local ok, err = pcall(fn)
    if not ok and not warned then
        warned = true
        warn("[MurzzHub Debug] "..err)
    end
end

-------------------------------------------------
-- RAYFIELD
-------------------------------------------------
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "MurzzHub "..VERSION,
    LoadingTitle = "MurzzHub "..VERSION,
    LoadingSubtitle = "Stable Live Player Data & Quests",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MurzzHub",
        FileName = "AFSE_UI"
    }
})

-------------------------------------------------
-- UTIL
-------------------------------------------------
local function abbreviate(n)
    if n >= 1e12 then return string.format("%.2fT", n/1e12)
    elseif n >= 1e9 then return string.format("%.2fB", n/1e9)
    elseif n >= 1e6 then return string.format("%.2fM", n/1e6)
    elseif n >= 1e3 then return string.format("%.2fK", n/1e3)
    else return tostring(n) end
end

-------------------------------------------------
-- MAPS
-------------------------------------------------
local ClassMap = {
    [1]="Fighter",[2]="Shinobi",[3]="Pirate",[4]="Ghoul",[5]="Hero",
    [6]="Reaper",[7]="Saiyan",[8]="Sin",[9]="Magi",[10]="Akuma",
    [11]="Yonko",[12]="Gorosei",[13]="Overlord",[14]="Hokage",
    [15]="Kaioshin",[16]="Sage",[17]="Espada",[18]="Shinigami",
    [19]="Hashira",[20]="Hakaishin",[21]="Otsutsuki",
    [22]="Pirate King",[23]="Kishin",[24]="Angel",
    [25]="Demon King",[26]="Ultra Instinct",[27]="Upper Moon"
}

local StatMap = {
    ["1"]={"Strength","ğŸ’ª"},
    ["2"]={"Durability","ğŸ›¡ï¸"},
    ["3"]={"Chakra","ğŸŒ€"},
    ["4"]={"Sword","ğŸ—¡ï¸"},
    ["5"]={"Speed","ğŸ’¨"},
    ["6"]={"Agility","â˜ï¸"},
}

-------------------------------------------------
-- INFO TAB (UNCHANGED)
-------------------------------------------------
local InfoTab = Window:CreateTab("Info ğŸ› ï¸")

InfoTab:CreateSection("Update Log ğŸ“")
InfoTab:CreateParagraph({
    Title = VERSION,
    Content = [[
â€¢ Quest Overview added to Home
â€¢ Live percentage calculation
â€¢ Tick placement rule enforced
]]
})

InfoTab:CreateSection("Discord ğŸ’¬")
InfoTab:CreateParagraph({
    Title = "Dear @"..Player.DisplayName,
    Content = [[
Thank you for using MurzzHub â¤ï¸
Your support drives development forward.
]]
})

InfoTab:CreateButton({
    Name = "Join Discord",
    Callback = function()
        setclipboard("DISCORD_LINK_HERE")
    end
})

-------------------------------------------------
-- HOME TAB
-------------------------------------------------
local HomeTab = Window:CreateTab("Home ğŸ ")

HomeTab:CreateSection("Player Data ğŸ‘¤")

local ClassLabel = HomeTab:CreateLabel("Class: ...")
local PowerLabel = HomeTab:CreateLabel("Total Power: ... âš¡")
local YenLabel = HomeTab:CreateLabel("Money: ... ğŸ’°")
local ChikaraLabel = HomeTab:CreateLabel("Chikara: ... ğŸ’")

-------------------------------------------------
-- LIVE STATS
-------------------------------------------------
HomeTab:CreateSection("Live Stats ğŸ“Š")

for id,data in pairs(StatMap) do
    local name, emoji = unpack(data)
    local label = HomeTab:CreateLabel(name..": ... "..emoji)
    local stat = StatsFolder:FindFirstChild(id)
    if stat then
        local function update()
            label:Set(name..": "..abbreviate(stat.Value).." "..emoji)
        end
        update()
        stat:GetPropertyChangedSignal("Value"):Connect(update)
    end
end

local function bindValue(obj, label, prefix, emoji)
    if not obj then return end
    local function update()
        label:Set(prefix..abbreviate(obj.Value).." "..emoji)
    end
    update()
    obj:GetPropertyChangedSignal("Value"):Connect(update)
end

bindValue(OtherData:FindFirstChild("TotalPower"), PowerLabel, "Total Power: ", "âš¡")
bindValue(OtherData:FindFirstChild("Yen"), YenLabel, "Money: ", "ğŸ’°")
bindValue(OtherData:FindFirstChild("Chikara"), ChikaraLabel, "Chikara: ", "ğŸ’")

if OtherData:FindFirstChild("Class") then
    local function update()
        ClassLabel:Set("Class: "..(ClassMap[OtherData.Class.Value] or "Unknown").." ğŸ§¬")
    end
    update()
    OtherData.Class:GetPropertyChangedSignal("Value"):Connect(update)
end

-------------------------------------------------
-- QUEST OVERVIEW (NEW)
-------------------------------------------------
HomeTab:CreateSection("Quests Overview ğŸ“œ")

local OverviewLabels = {}

local function calculateQuestPercent(quest)
    local reqs = quest:FindFirstChild("Requirements")
    if not reqs then return 0 end

    local totalReq, totalProg = 0, 0

    for _,req in ipairs(reqs:GetChildren()) do
        if req:IsA("IntValue") or req:IsA("NumberValue") then
            totalReq += req.Value

            local progress = 0
            if quest:FindFirstChild("Progress")
                and quest.Progress:FindFirstChild(req.Name) then
                progress = quest.Progress[req.Name].Value
            elseif quest:FindFirstChild(req.Name) then
                progress = quest[req.Name].Value
            end

            totalProg += progress
        end
    end

    if totalReq <= 0 then return 0 end
    return math.clamp(math.floor((totalProg / totalReq) * 100), 0, 100)
end

local function setupOverview(quest)
    safeRun(function()
        local display = quest.Name:gsub("(%a+)(%d+)", "%1 No.%2")
        local label = HomeTab:CreateLabel(display.." (0%)")
        OverviewLabels[quest] = label

        local function update()
            local percent = calculateQuestPercent(quest)
            label:Set(display.." ("..percent.."%)")
        end

        update()

        for _,obj in ipairs(quest:GetDescendants()) do
            if obj:IsA("IntValue") or obj:IsA("NumberValue") then
                obj:GetPropertyChangedSignal("Value"):Connect(update)
            end
        end
    end)
end

for _,q in ipairs(QuestsFolder:GetChildren()) do
    if q:IsA("Folder") then
        setupOverview(q)
    end
end

QuestsFolder.ChildAdded:Connect(function(q)
    if q:IsA("Folder") then
        setupOverview(q)
    end
end)

-------------------------------------------------
-- QUESTS TAB (UNCHANGED, WORKING)
-------------------------------------------------
local QuestsTab = Window:CreateTab("Quests ğŸ“")

-------------------------------------------------
-- AUTO FARMS TAB
-------------------------------------------------
local AutoFarmTab = Window:CreateTab("Auto Farms âš™ï¸")

AutoFarmTab:CreateSection("Coming Soon ğŸš§")
AutoFarmTab:CreateLabel("Auto Train")
AutoFarmTab:CreateLabel("Auto Quest")
AutoFarmTab:CreateLabel("Zone-aware farming")

-------------------------------------------------
-- DONE
-------------------------------------------------
Rayfield:LoadConfiguration()
print("[MurzzHub] "..VERSION.." loaded successfully")
