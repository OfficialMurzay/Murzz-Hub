-- MurzzHub v1.0c Beta
-- Rayfield UI for Anime Fighting Simulator: Endless
-- Author: Murzay

--[[ 
ðŸ“ Features:
- Animated loading (stats count up from 0)
- Live player stats
- Live quests overview with percentage
- Abbreviated numbers (K, M, B, T, Qd, Qn, Sx)
- Class detection with emoji
- Modern, lively UI
- Automatic updates
- Debugging messages
- Reliable label creation directly on the tab (fixes CreateLabel errors)
]]

--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

--// Rayfield Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
print("[MurzzHub] Rayfield loaded")

--// Class Table with Emojis
local Classes = {
    [1]="Fighter ðŸ¥Š",[2]="Shinobi ðŸŒ€",[3]="Pirate â˜ ï¸",[4]="Ghoul ðŸ‘»",[5]="Hero ðŸ¦¸",
    [6]="Reaper â˜ ï¸",[7]="Saiyan ðŸ’¥",[8]="Sin ðŸ˜ˆ",[9]="Magi ðŸ§™",[10]="Akuma ðŸ˜¡",
    [11]="Yonko ðŸ´â€â˜ ï¸",[12]="Gorosei ðŸ§“",[13]="Overlord ðŸ‘‘",[14]="Hokage ðŸ¦Š",
    [15]="Kaioshin ðŸ‘¼",[16]="Sage ðŸ•Šï¸",[17]="Espada âš”ï¸",[18]="Shinigami ðŸ‘¹",
    [19]="Hashira âš”ï¸",[20]="Hakaishin ðŸ’€",[21]="Otsutsuki ðŸŒŒ",
    [22]="Pirate King ðŸ´â€â˜ ï¸ðŸ‘‘",[23]="Kishin ðŸ‘¿",[24]="Angel ðŸ˜‡",
    [25]="Demon King ðŸ‘¹",[26]="Ultra Instinct âœ¨",[27]="Upper Moon ðŸŒ™"
}

--// Utility: Format numbers
local function abbreviateNumber(num)
    local absNum = math.abs(num)
    if absNum >= 1e21 then return string.format("%.2fSx", num / 1e21)
    elseif absNum >= 1e18 then return string.format("%.2fQn", num / 1e18)
    elseif absNum >= 1e15 then return string.format("%.2fQd", num / 1e15)
    elseif absNum >= 1e12 then return string.format("%.2fT", num / 1e12)
    elseif absNum >= 1e9 then return string.format("%.2fB", num / 1e9)
    elseif absNum >= 1e6 then return string.format("%.2fM", num / 1e6)
    elseif absNum >= 1e3 then return string.format("%.2fK", num / 1e3)
    else return tostring(num)
    end
end

--// Animated increment function
local function animateValue(label, startVal, endVal, duration)
    local step = (endVal - startVal) / (duration * 30)
    local current = startVal
    local connection
    connection = RunService.RenderStepped:Connect(function()
        current = current + step
        if (step > 0 and current >= endVal) or (step < 0 and current <= endVal) then
            current = endVal
            connection:Disconnect()
        end
        if label and label.Set then
            label:Set(abbreviateNumber(math.floor(current)))
        end
    end)
end

--// Loading Screen
Rayfield:LoadConfiguration({
    Name = "MurzzHub Scripts",
    LoadingTitle = "MurzzHub Scripts",
    LoadingSubtitle = "v1.0c Beta",
    ConfigurationSaving = { Enabled = true, FolderName = nil, FileName = "MurzzHub" }
})
print("[MurzzHub] Configuration loaded")

--// Main Window
local Window = Rayfield:CreateWindow({
    Name = "Murzzhub | AFSE",
    LoadingTitle = "MurzzHub Scripts",
    LoadingSubtitle = "v1.0c Beta",
    ConfigurationSaving = { Enabled = true, FolderName = nil, FileName = "MurzzHub" }
})
print("[MurzzHub] Window created")

--// Home Tab
local HomeTab = Window:CreateTab("Home ðŸ ", nil)

-- Optional visual sections (not required for CreateLabel)
local PlayerSection = HomeTab:CreateSection("Player Data ðŸ§‘â€ðŸ’»")
local StatsSection  = HomeTab:CreateSection("Live Stats âš¡")
local QuestSection  = HomeTab:CreateSection("Quests Overview ðŸ—‚ï¸")

--// Player Data Labels (created directly on tab)
local ClassLabel      = HomeTab:CreateLabel({ Name = "Class: ..." })
local TotalPowerLabel = HomeTab:CreateLabel({ Name = "Total Power: ..." })
local YenLabel        = HomeTab:CreateLabel({ Name = "Yen: ..." })
local ChikaraLabel    = HomeTab:CreateLabel({ Name = "Chikara: ..." })

--// Stats Labels
local StatLabels = {}
local StatNames = {"Strength", "Durability", "Chakra", "Sword", "Speed", "Agility"}
for _, statName in ipairs(StatNames) do
    StatLabels[statName] = HomeTab:CreateLabel({ Name = statName.." : ..." })
end

--// Quest Labels
local QuestLabels = {}

--// Wait for child safely
local function waitForChildSafe(parent, name, timeout)
    local t0 = tick()
    while tick() - t0 < (timeout or 5) do
        local child = parent:FindFirstChild(name)
        if child then return child end
        task.wait(0.1)
    end
    warn("[MurzzHub] Child not found:", name)
    return nil
end

--// Update UI
local function updateUI()
    local OtherData = waitForChildSafe(LocalPlayer, "OtherData")
    local Stats = waitForChildSafe(LocalPlayer, "Stats")
    local Quests = waitForChildSafe(LocalPlayer, "Quests")
    if not OtherData or not Stats or not Quests then return end

    -- Player Data
    if ClassLabel then
        local classId = waitForChildSafe(OtherData, "Class") and OtherData.Class.Value or 0
        ClassLabel:Set("Class: "..(Classes[classId] or "Unknown â“"))
    end
    if TotalPowerLabel and waitForChildSafe(OtherData, "TotalPower") then
        animateValue(TotalPowerLabel, 0, OtherData.TotalPower.Value, 0.5)
    end
    if YenLabel and waitForChildSafe(OtherData, "Yen") then
        animateValue(YenLabel, 0, OtherData.Yen.Value, 0.5)
    end
    if ChikaraLabel and waitForChildSafe(OtherData, "Chikara") then
        animateValue(ChikaraLabel, 0, OtherData.Chikara.Value, 0.5)
    end

    -- Stats
    for i, statName in ipairs(StatNames) do
        if StatLabels[statName] and Stats[tostring(i)] then
            animateValue(StatLabels[statName], 0, Stats[tostring(i)].Value, 0.5)
        end
    end

    -- Quests
    for _, questFolder in ipairs(Quests:GetChildren()) do
        if not QuestLabels[questFolder.Name] then
            QuestLabels[questFolder.Name] = HomeTab:CreateLabel({ Name = questFolder.Name.." : 0%" })
        end

        local progressSum, requirementSum = 0, 0
        local Progress = questFolder:FindFirstChild("Progress")
        local Requirements = questFolder:FindFirstChild("Requirements")
        if Progress and Requirements then
            for i=1,6 do
                local progVal = Progress:FindFirstChild(tostring(i))
                local reqVal = Requirements:FindFirstChild(tostring(i))
                if progVal and reqVal then
                    progressSum = progressSum + progVal.Value
                    requirementSum = requirementSum + reqVal.Value
                end
            end
        end
        local percent = 0
        if requirementSum > 0 then
            percent = math.floor(progressSum / requirementSum * 100)
        end
        if QuestLabels[questFolder.Name] then
            QuestLabels[questFolder.Name]:Set(questFolder.Name.." : "..percent.."%")
        end
    end
end

-- Initial animated load
local function initialLoad()
    local OtherData = waitForChildSafe(LocalPlayer, "OtherData")
    local Stats = waitForChildSafe(LocalPlayer, "Stats")
    if not OtherData or not Stats then return end
    if TotalPowerLabel then animateValue(TotalPowerLabel, 0, OtherData.TotalPower.Value, 1) end
    if YenLabel then animateValue(YenLabel, 0, OtherData.Yen.Value, 1) end
    if ChikaraLabel then animateValue(ChikaraLabel, 0, OtherData.Chikara.Value, 1) end
    for i, statName in ipairs(StatNames) do
        if StatLabels[statName] then
            animateValue(StatLabels[statName], 0, Stats[tostring(i)].Value, 1)
        end
    end
end
initialLoad()

-- Update every frame
RunService.RenderStepped:Connect(updateUI)

-- Save/load Rayfield configuration
Rayfield:LoadConfiguration()
print("[MurzzHub] Script v1.0c Beta loaded successfully")
