-- MurzzHub v1.0p Beta (UI + Player Data, Stats & Quest Overview + Info Tab + Quests Tab)
-- Author: Murzay (Modified by ChatGPT)
-- VERSION NOTE: v1.0o -> v1.0p (Live Animated & Abbreviated Quest Progress, Notifications Removed)

-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer
local OtherData = Player:WaitForChild("OtherData")
local StatsFolder = Player:WaitForChild("Stats")
local QuestsFolder = Player:WaitForChild("Quests")

-------------------------------------------------
-- VERSION
-------------------------------------------------
local VERSION = "v1.0p Beta"

-------------------------------------------------
-- DEBUG SYSTEM
-------------------------------------------------
local debugErrorShown = false
local function safeRun(func)
    local ok, err = pcall(func)
    if not ok and not debugErrorShown then
        debugErrorShown = true
        warn("[MurzzHub Debug] An error occurred:\n"..err)
    end
end

-------------------------------------------------
-- RAYFIELD
-------------------------------------------------
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "MurzzHub "..VERSION,
    LoadingTitle = "MurzzHub "..VERSION,
    LoadingSubtitle = VERSION.." - UI Live Player Data, Stats & Quests",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MurzzHub",
        FileName = "AFSE_UI"
    },
    KeySystem = false
})

-------------------------------------------------
-- UTILITIES
-------------------------------------------------
local function abbreviateNumber(num)
    if not num then return "0" end
    local absNum = math.abs(num)
    if absNum >= 1e21 then return string.format("%.2fSx", num/1e21)
    elseif absNum >= 1e18 then return string.format("%.2fQn", num/1e18)
    elseif absNum >= 1e15 then return string.format("%.2fQd", num/1e15)
    elseif absNum >= 1e12 then return string.format("%.2fT", num/1e12)
    elseif absNum >= 1e9 then return string.format("%.2fB", num/1e9)
    elseif absNum >= 1e6 then return string.format("%.2fM", num/1e6)
    elseif absNum >= 1e3 then return string.format("%.2fK", num/1e3)
    else return tostring(num) end
end

local function animateValue(label, startVal, endVal, prefix, emoji, duration)
    if startVal == endVal then return end
    local step = (endVal - startVal)/(duration*30)
    local current = startVal
    local connection
    connection = RunService.RenderStepped:Connect(function()
        current = current + step
        if (step > 0 and current >= endVal) or (step < 0 and current <= endVal) then
            current = endVal
            connection:Disconnect()
        end
        if label and label.Set then label:Set(prefix..abbreviateNumber(math.floor(current)).." "..emoji) end
    end)
end

-------------------------------------------------
-- CLASS MAP
-------------------------------------------------
local ClassMap = {
    [1]="Fighter ü•ä",[2]="Shinobi üåÄ",[3]="Pirate ‚ò†Ô∏è",[4]="Ghoul üëª",[5]="Hero ü¶∏",
    [6]="Reaper ‚ò†Ô∏è",[7]="Saiyan üí•",[8]="Sin üòà",[9]="Magi üßô",[10]="Akuma üò°",
    [11]="Yonko üè¥‚Äç‚ò†Ô∏è",[12]="Gorosei üßì",[13]="Overlord üëë",[14]="Hokage ü¶ä",
    [15]="Kaioshin üëº",[16]="Sage üïäÔ∏è",[17]="Espada ‚öîÔ∏è",[18]="Shinigami üëπ",
    [19]="Hashira ‚öîÔ∏è",[20]="Hakaishin üíÄ",[21]="Otsutsuki üåå",
    [22]="Pirate King üè¥‚Äç‚ò†Ô∏èüëë",[23]="Kishin üëø",[24]="Angel üòá",
    [25]="Demon King üëπ",[26]="Ultra Instinct ‚ú®",[27]="Upper Moon üåô"
}

-------------------------------------------------
-- STAT MAP
-------------------------------------------------
local StatIdToName = {
    [1]="Strength üí™",[2]="Durability üõ°Ô∏è",[3]="Chakra üåÄ",[4]="Sword üó°Ô∏è",[5]="Speed üí®",[6]="Agility ‚òÅÔ∏è"
}

-------------------------------------------------
-- INFO TAB
-------------------------------------------------
local InfoTab = Window:CreateTab("Info üõ†Ô∏è")
InfoTab:CreateSection("Update Log üìù")
InfoTab:CreateParagraph({
    Title = "Update Log "..VERSION..": Live Animated & Abbreviated Quests üìù",
    Content = "Quests now smoothly live-update with animated and abbreviated numbers. Supports numeric stats and custom-named requirements like 'Kill'. Notifications removed."
})

InfoTab:CreateSection("Discord üí¨")
InfoTab:CreateParagraph({
    Title = "Dear @"..Player.DisplayName,
    Content = [[
Thank you for using my script! Every use really supports me, and gives me motivation to continue updating this script!
If you have any suggestions, or just want to see sneak peaks, events and more then join the Discord Server! ‚ù§Ô∏è - Murzay (Scripter)
]]
})
InfoTab:CreateButton({
    Name = "Join The Discord Server!",
    Callback = function()
        safeRun(function()
            local discordLink = "DISCORD_LINK_HERE"
            if discordLink and discordLink ~= "" then
                if syn and syn.request then
                    syn.request({Url=discordLink})
                else
                    setclipboard(discordLink)
                end
            end
        end)
    end
})

-------------------------------------------------
-- HOME TAB
-------------------------------------------------
local HomeTab = Window:CreateTab("Home üè†")
HomeTab:CreateSection("Player Data üë§")
local ClassLabel = HomeTab:CreateLabel("Class: ...")
local PowerLabel = HomeTab:CreateLabel("Total Power: ... ‚ö°")
local YenLabel = HomeTab:CreateLabel("Money: ... üí∞")
local ChikaraLabel = HomeTab:CreateLabel("Chikara: ... üíé")

HomeTab:CreateSection("Live Stats üìä")
local LiveStats = {}
for statId, name in pairs(StatIdToName) do
    local statName, emoji = name:match("^(.-) (.+)$")
    LiveStats[statId] = {Label=HomeTab:CreateLabel(statName..": ... "..emoji), Value=0, Emoji=emoji, StatName=statName}
end

HomeTab:CreateSection("Quest Overview üìú")
local QuestOverviewLabels = {}
local function createQuestLabel(questFolder)
    safeRun(function()
        if not questFolder then return end
        local displayName = questFolder.Name
        local name, number = displayName:match("(%a+)(%d+)")
        if name and number then displayName = name.." No."..number end
        if not QuestOverviewLabels[questFolder.Name] then
            local label = HomeTab:CreateLabel(displayName.." [0%]")
            QuestOverviewLabels[questFolder.Name]={Label=label, Completed=false}
        end
    end)
end
for _, questFolder in ipairs(QuestsFolder:GetChildren()) do createQuestLabel(questFolder) end
QuestsFolder.ChildAdded:Connect(function(child)
    if child:IsA("Folder") then createQuestLabel(child) end
end)

-------------------------------------------------
-- QUESTS TAB
-------------------------------------------------
local QuestsTab = Window:CreateTab("Quests üìú")
QuestsTab:CreateSection("Current Quests üìå")
local QuestParagraphs = {}
local QuestValues = {} -- Track live values for animation

local function updateQuestParagraph(questFolder)
    safeRun(function()
        if not questFolder then return end
        local displayName = questFolder.Name
        local name, number = displayName:match("(%a+)(%d+)")
        if name and number then displayName = name.." No."..number end

        local Requirements = questFolder:FindFirstChild("Requirements")
        if not Requirements then return end

        QuestValues[questFolder.Name] = QuestValues[questFolder.Name] or {}
        local descLines = {}
        local allComplete = true

        for _, req in ipairs(Requirements:GetChildren()) do
            if req:IsA("IntValue") or req:IsA("NumberValue") then
                local progVal = 0
                local progFolder = questFolder:FindFirstChild("Progress")
                if progFolder then
                    local prog = progFolder:FindFirstChild(req.Name)
                    if prog and (prog:IsA("IntValue") or prog:IsA("NumberValue")) then
                        progVal = prog.Value
                    end
                else
                    local prog = questFolder:FindFirstChild(req.Name)
                    if prog and (prog:IsA("IntValue") or prog:IsA("NumberValue")) then
                        progVal = prog.Value
                    end
                end

                QuestValues[questFolder.Name][req.Name] = QuestValues[questFolder.Name][req.Name] or progVal
                local currentVal = QuestValues[questFolder.Name][req.Name]

                local step = (progVal - currentVal)/5
                if step ~= 0 then
                    currentVal = currentVal + step
                    if (step > 0 and currentVal > progVal) or (step < 0 and currentVal < progVal) then
                        currentVal = progVal
                    end
                    QuestValues[questFolder.Name][req.Name] = currentVal
                end

                local statName, emoji
                local numId = tonumber(req.Name)
                if numId and StatIdToName[numId] then
                    local fullName = StatIdToName[numId]
                    statName, emoji = fullName:match("^(.-) (.+)$")
                    statName = statName or fullName
                    emoji = emoji or ""
                else
                    statName = req.Name
                    emoji = ""
                end

                local complete = progVal >= req.Value
                if not complete then allComplete = false end
                table.insert(descLines, string.format("%s/%s %s %s%s", abbreviateNumber(math.floor(currentVal)), abbreviateNumber(req.Value), statName, emoji, complete and " ‚úÖ" or ""))
            end
        end

        local descText = table.concat(descLines,"\n")
        local titleText = displayName..(allComplete and " ‚úÖ" or "")

        local paragraph = QuestParagraphs[questFolder.Name]
        if not paragraph then
            paragraph = QuestsTab:CreateParagraph({Title=titleText, Content=descText})
            QuestParagraphs[questFolder.Name] = paragraph
        else
            if paragraph and paragraph.Set then paragraph:Set(descText) end
            if paragraph then paragraph.Title = titleText end
        end
    end)
end

for _, questFolder in ipairs(QuestsFolder:GetChildren()) do updateQuestParagraph(questFolder) end
QuestsFolder.ChildAdded:Connect(function(child) if child:IsA("Folder") then updateQuestParagraph(child) end end)

RunService.Heartbeat:Connect(function()
    safeRun(function()
        if OtherData:FindFirstChild("Class") then
            ClassLabel:Set("Class: "..(ClassMap[OtherData.Class.Value] or "Unknown ‚ùì"))
        end
        if OtherData:FindFirstChild("TotalPower") then
            animateValue(PowerLabel,PowerLabel.Value or 0,OtherData.TotalPower.Value,"Total Power: ","‚ö°",0.5)
        end
        if OtherData:FindFirstChild("Yen") then
            animateValue(YenLabel,YenLabel.Value or 0,OtherData.Yen.Value,"Money: ","üí∞",0.5)
        end
        if OtherData:FindFirstChild("Chikara") then
            animateValue(ChikaraLabel,ChikaraLabel.Value or 0,OtherData.Chikara.Value,"Chikara: ","üíé",0.5)
        end

        for statId,data in pairs(LiveStats) do
            local statObj = StatsFolder:FindFirstChild(tostring(statId))
            if statObj and statObj.Value ~= data.Value then
                animateValue(data.Label,data.Value,statObj.Value,data.StatName..": ",data.Emoji,0.5)
                data.Value = statObj.Value
            end
        end

        for questName, paragraph in pairs(QuestParagraphs) do
            local questFolder = QuestsFolder:FindFirstChild(questName)
            if questFolder then updateQuestParagraph(questFolder) end
        end
    end)
end)

-------------------------------------------------
-- DONE
-------------------------------------------------
Rayfield:LoadConfiguration()
print("[MurzzHub] UI + Player Data, Stats & Quest Overview + Quests Tab "..VERSION.." loaded successfully")
