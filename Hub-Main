-- MurzzHub v1.0l Beta (Fixed Quest Overview with abbreviated numbers)
-- Author: Murzay (Modified by ChatGPT)

-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer
local OtherData = Player:WaitForChild("OtherData")
local StatsFolder = Player:WaitForChild("Stats")
local QuestsFolder = Player:WaitForChild("Quests")

-------------------------------------------------
-- VERSION
-------------------------------------------------
local VERSION = "v1.0l Beta"

-------------------------------------------------
-- RAYFIELD
-------------------------------------------------
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "MurzzHub "..VERSION,
    LoadingTitle = "MurzzHub "..VERSION,
    LoadingSubtitle = VERSION.." - UI Live Player Data, Stats & Quests",
    ConfigurationSaving = {Enabled=true, FolderName="MurzzHub", FileName="AFSE_UI"},
    KeySystem=false
})

-------------------------------------------------
-- MAPS
-------------------------------------------------
local ClassMap = {
    [1]="Fighter ü•ä",[2]="Shinobi üåÄ",[3]="Pirate ‚ò†Ô∏è",[4]="Ghoul üëª",[5]="Hero ü¶∏",
    [6]="Reaper ‚ò†Ô∏è",[7]="Saiyan üí•",[8]="Sin üòà",[9]="Magi üßô",[10]="Akuma üò°",
    [11]="Yonko üè¥‚Äç‚ò†Ô∏è",[12]="Gorosei üßì",[13]="Overlord üëë",[14]="Hokage ü¶ä",
    [15]="Kaioshin üëº",[16]="Sage üïäÔ∏è",[17]="Espada ‚öîÔ∏è",[18]="Shinigami üëπ",
    [19]="Hashira ‚öîÔ∏è",[20]="Hakaishin üíÄ",[21]="Otsutsuki üåå",
    [22]="Pirate King üè¥‚Äç‚ò†Ô∏èüëë",[23]="Kishin üëø",[24]="Angel üòá",
    [25]="Demon King üëπ",[26]="Ultra Instinct ‚ú®",[27]="Upper Moon üåô"
}

local StatIdToName = {
    [1]="Strength üí™",[2]="Durability üõ°Ô∏è",[3]="Chakra üåÄ",[4]="Sword üó°Ô∏è",[5]="Speed üí®",[6]="Agility ‚òÅÔ∏è"
}

-------------------------------------------------
-- UTIL
-------------------------------------------------
local function abbreviateNumber(num)
    if not num then return "0" end
    local absNum = math.abs(num)
    if absNum >= 1e21 then return string.format("%.2fSx", num/1e21)
    elseif absNum >= 1e18 then return string.format("%.2fQn", num/1e18)
    elseif absNum >= 1e15 then return string.format("%.2fQd", num/1e15)
    elseif absNum >= 1e12 then return string.format("%.2fT", num/1e12)
    elseif absNum >= 1e9 then return string.format("%.2fB", num/1e9)
    elseif absNum >= 1e6 then return string.format("%.2fM", num/1e6)
    elseif absNum >= 1e3 then return string.format("%.2fK", num/1e3)
    else return tostring(num) end
end

-------------------------------------------------
-- INFO TAB
-------------------------------------------------
local InfoTab = Window:CreateTab("Info üõ†Ô∏è")
InfoTab:CreateSection("Update Log üìù")
InfoTab:CreateParagraph({
    Title="Update Log "..VERSION,
    Content="Added fully fixed Quest Overview with abbreviated numbers and live updates."
})
InfoTab:CreateSection("Discord üí¨")
InfoTab:CreateParagraph({
    Title="Message",
    Content="Dear @"..Player.DisplayName..", thank you for using my script! Join the Discord for sneak peeks, events, and more. ‚ù§Ô∏è - Murzay"
})
InfoTab:CreateButton({
    Name="Join The Discord Server!",
    Callback=function() setclipboard("DISCORD_LINK_HERE") end
})

-------------------------------------------------
-- HOME TAB
-------------------------------------------------
local HomeTab = Window:CreateTab("Home üè†")
HomeTab:CreateSection("Player Data üë§")
local ClassLabel = HomeTab:CreateLabel("Class: ...")
local PowerLabel = HomeTab:CreateLabel("Total Power: ... ‚ö°")
local YenLabel = HomeTab:CreateLabel("Money: ... üí∞")
local ChikaraLabel = HomeTab:CreateLabel("Chikara: ... üíé")

HomeTab:CreateSection("Live Stats üìä")
local LiveStats = {}
for statId,name in pairs(StatIdToName) do
    local statName, emoji = name:match("^(.-) (.+)$")
    LiveStats[statId] = {Label=HomeTab:CreateLabel(statName..": ... "..emoji), StatName=statName, Emoji=emoji}
end

HomeTab:CreateSection("Quest Overview üìú")
local QuestOverviewLabels = {}

local function updateQuestOverview()
    for _, quest in ipairs(QuestsFolder:GetChildren()) do
        if quest:IsA("Folder") then
            local displayName = quest.Name
            local name,num = displayName:match("(%a+)(%d+)")
            if name and num then displayName = name.." No."..num end

            local req = quest:FindFirstChild("Requirements")
            local prog = quest:FindFirstChild("Progress")
            if not req or not prog then continue end

            local totalReq,totalProg = 0,0
            for _, r in ipairs(req:GetChildren()) do
                if r:IsA("IntValue") then
                    local p = prog:FindFirstChild(r.Name)
                    local val = 0
                    if r.Name == "Kill" and prog:FindFirstChild("Kill") then
                        val = prog.Kill.Value
                    elseif p then val = p.Value end
                    totalReq += r.Value
                    totalProg += val
                end
            end
            local percent = totalReq>0 and math.floor((totalProg/totalReq)*100) or 0
            local text = displayName.." ["..percent.."%]"

            if not QuestOverviewLabels[quest.Name] then
                QuestOverviewLabels[quest.Name] = HomeTab:CreateLabel(text)
            else
                QuestOverviewLabels[quest.Name]:Set(text)
            end
        end
    end
end

QuestsFolder.ChildAdded:Connect(updateQuestOverview)
RunService.Heartbeat:Connect(updateQuestOverview)

-------------------------------------------------
-- QUESTS TAB
-------------------------------------------------
local QuestsTab = Window:CreateTab("Quests üìú")
QuestsTab:CreateSection("Current Quests üìå")
local QuestParagraphs = {}
local function updateQuestParagraph(quest)
    local displayName = quest.Name
    local name,num = displayName:match("(%a+)(%d+)")
    if name and num then displayName = name.." No."..num end

    local req = quest:FindFirstChild("Requirements")
    local prog = quest:FindFirstChild("Progress")
    if not req or not prog then return end

    local lines = {}
    local allComplete = true
    for _, r in ipairs(req:GetChildren()) do
        if r:IsA("IntValue") then
            local p = prog:FindFirstChild(r.Name)
            local val = 0
            if r.Name == "Kill" and prog:FindFirstChild("Kill") then
                val = prog.Kill.Value
            elseif p then val = p.Value end
            if val < r.Value then allComplete=false end
            table.insert(lines, abbreviateNumber(val).."/"..abbreviateNumber(r.Value).." "..r.Name..(val>=r.Value and " ‚úÖ" or ""))
        end
    end

    local title = displayName..(allComplete and " ‚úÖ" or "")
    if not QuestParagraphs[quest.Name] then
        QuestParagraphs[quest.Name] = QuestsTab:CreateParagraph({Title=title, Content=table.concat(lines,"\n")})
    else
        QuestParagraphs[quest.Name]:Set(table.concat(lines,"\n"))
        QuestParagraphs[quest.Name].Title = title
    end
end

for _, q in ipairs(QuestsFolder:GetChildren()) do updateQuestParagraph(q) end
QuestsFolder.ChildAdded:Connect(function(child) if child:IsA("Folder") then updateQuestParagraph(child) end end)
RunService.Heartbeat:Connect(function()
    for questName, para in pairs(QuestParagraphs) do
        local qFolder = QuestsFolder:FindFirstChild(questName)
        if qFolder then updateQuestParagraph(qFolder) end
    end
end)

-------------------------------------------------
-- PLAYER DATA & STATS LIVE UPDATE
-------------------------------------------------
RunService.Heartbeat:Connect(function()
    if OtherData:FindFirstChild("Class") then
        ClassLabel:Set("Class: "..(ClassMap[OtherData.Class.Value] or "Unknown ‚ùì"))
    end
    if OtherData:FindFirstChild("TotalPower") then
        PowerLabel:Set("Total Power: "..abbreviateNumber(OtherData.TotalPower.Value).." ‚ö°")
    end
    if OtherData:FindFirstChild("Yen") then
        YenLabel:Set("Money: "..abbreviateNumber(OtherData.Yen.Value).." üí∞")
    end
    if OtherData:FindFirstChild("Chikara") then
        ChikaraLabel:Set("Chikara: "..abbreviateNumber(OtherData.Chikara.Value).." üíé")
    end

    for id,data in pairs(LiveStats) do
        local stat = StatsFolder:FindFirstChild(tostring(id))
        if stat then
            data.Label:Set(data.StatName..": "..abbreviateNumber(stat.Value).." "..data.Emoji)
        end
    end
end)

-------------------------------------------------
-- DONE
-------------------------------------------------
Rayfield:LoadConfiguration()
print("[MurzzHub] Fully fixed Quest Overview with abbreviated numbers loaded successfully")
